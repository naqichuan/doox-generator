

<script type="text/javascript">
    var button = {
        loadCenter: function () {
            return $('#loadCenter');
        },
        checkForm: function () {
            if (!ws.wsPathExists || !ws.wsPath().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'WS not exists.'
                });
                return false;
            } else if (!ws.author().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please input author.'
                });
                return false;
            } else if (!project.pName().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please select project.'
                });
                return false;
            } else if (!provide._().is(":checked")
                && !dao._().is(":checked")
                && !service._().is(":checked")
                && !web._().is(":checked")) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please select modules.'
                });
                return false;
            }
            return true;
        }
    };
</script>
<script type="text/javascript">
    var tableInfo = {
        projectDiv: function () {
            return $('#config_pojo_div');
        },
        info: function () {
            return $('tbody#tableInfo');
        },
        addInfo: function (columns) {
            if (!columns && columns.length === 0)
                return;
            this.info().html('');

            for (var idx in columns) {
                var colstr = '<tr>';
                colstr += '<td>' + columns[idx].field + '</td>';
                colstr += '<td>' + columns[idx].type + '</td>';
                colstr += '<td>' + columns[idx].collation + '</td>';
                colstr += '<td>' + columns[idx].isNull + '</td>';
                colstr += '<td>' + columns[idx].key + '</td>';
                colstr += '<td>' + columns[idx].defaultValue + '</td>';
                colstr += '<td>' + columns[idx].extra + '</td>';
                colstr += '<td>' + columns[idx].privileges + '</td>';
                colstr += '<td>' + columns[idx].comment + '</td>';
                colstr += '</tr>';

                this.info().append(colstr);
            }
        },
        projectInit: function () {
            this.loadTable()
        },
        loadTable: function () {
            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var columns = [];
            nqcxGet("generator-api/table/get/" + tableName, {}, function (result) {
                if (result.object && result.object.columns) {
                    columns = result.object.columns;
                }
                tableInfo.addInfo(columns);
                tableInfo.config(columns);
            });
        },
        config: function (columns) {
            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var tableHtml = '<hr />';
            tableHtml += '<table border="0" cellpadding="0" cellspacing="0">';
            for (idx in columns) {
                tableHtml += '<tr>' + this.row1(columns[idx]) + '</tr>';
            }
            tableHtml += '</table>';
            this.projectDiv().html(tableHtml);
        },
        row1: function (column) {
            var rowHtml = '';
            var field = column.field;
            var type = column.type;
            var field_ = this.toField(field);
            var type_ = this.toType(type);
            var show = 'private ' + type_ + ' ' + field_ + ";";

            rowHtml += '<td><input id="pojoColumn_' + field + '" type="text" name="pojoColumn" class="big_200" value="' + field + '" readonly="true" /></td>';
            rowHtml += '<td>' + type + '</td>';
            rowHtml += '<td><input id="pojoField_' + field + '" type="text" name="pojoField" class="big_200" value="' + field_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><input id="pojoType_' + field + '" type="text" name="pojoType" class="big" value="' + type_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><span id="jojoText_' + field + '">' + show + '</span></td>';

            return rowHtml;
        },
        show1: function (suffix) {
            var field_ = document.getElementById('pojoField_' + suffix).value;
            var type_ = document.getElementById('pojoType_' + suffix).value;
            var show1 = 'private ' + type_ + ' ' + field_ + ";";
            $('#jojoText_' + suffix).html(show1);
        },
        toField: function (input) {
            var prefix = table.colPrefix().val();
            var ps = prefix.split(',');
            if (ps != null && ps.length > 0) {
                for (var idx in ps) {
                    if (!ps[idx])
                        continue;
                    input = input.replace(new RegExp('^' + ps[idx], 'g'), '');
                }
            }
            return input.replaceFirstUP().replaceFirstLow();
        },
        toType: function (input) {
            if (input.startWith('bigint'))
                return "long";
            else if (input.startWith('int'))
                return "int";
            else if (input.startWith('tinyint'))
                return "int";
            else if (input.startWith('float'))
                return "float";
            else if (input.startWith('decimal'))
                return "BigDecimal";
            else if (input.startWith('varchar') || input.startWith('text'))
                return "String";
            else if (input.startWith('datetime') || input.startWith('date') || input.startWith('timestamp'))
                return "Date";
            else if (input.startWith('blob'))
                return "byte[]";
            else
                return input;
        }
    };
</script>
<script type="text/javascript">
    var provide = {
        _: function () {
            return $('input[name="provide_"]');
        },
        provideOPackage: function () {
            return $('input[name="provideOPackage"]');
        },
        provideO: function () {
            return $('input[name="provideO"]');
        },
        provideProvidePackage: function () {
            return $('input[name="provideProvidePackage"]');
        },
        provideProvide: function () {
            return $('input[name="provideProvide"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project package value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var provideName = tableName.replaceFirstUP();
            var provideO = provideName;
            var provideProvide = 'I' + provideName + 'Provide';

            var poValue = pValue + '.data.o' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            var ppValue = pValue + '.provide' + (tablePack ? "." + tablePack : "");
            if (ppValue.indexOf(".") === 0 && ppValue.length > 1)
                ppValue = ppValue.substring(1);

            // set value
            this.provideOPackage().val(poValue);
            this.provideO().val(provideO);

            this.provideProvidePackage().val(ppValue);
            this.provideProvide().val(provideProvide);
        }
    };
</script>
<script type="text/javascript">
    var dao = {
        _: function () {
            return $('input[name="dao_"]');
        },
        poPackage: function () {
            return $('input[name="daoPOPackage"]');
        },
        po: function () {
            return $('input[name="daoPO"]');
        },
        mapperPackage: function () {
            return $('input[name="daoMapperPackage"]');
        },
        mapper: function () {
            return $('input[name="daoMapper"]');
        },
        jpaPackage: function () {
            return $('input[name="daoJpaPackage"]');
        },
        jpa: function () {
            return $('input[name="daoJpa"]');
        },
        daoCacheSupportPackage: function () {
            return $('input[name="daoCacheSupportPackage"]');
        },
        daoCacheSupport: function () {
            return $('input[name="daoCacheSupport"]');
        },
        daoPackage: function () {
            return $('input[name="daoDAOPackage"]');
        },
        dao: function () {
            return $('input[name="daoDAO"]');
        },
        daoImplPackage: function () {
            return $('input[name="daoDAOImplPackage"]');
        },
        daoImpl: function () {
            return $('input[name="daoDAOImpl"]');
        },
        testPackage: function () {
            return $('input[name="daoDAOTestPackage"]');
        },
        test: function () {
            return $('input[name="daoDAOTest"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var daoName = tableName.replaceFirstUP();
            var daoPO = daoName + "PO";
            var daoMapper = 'I' + daoName + 'Mapper';
            var daoJpa = 'I' + daoName + 'Jpa';
            var daoCacheSupport = 'CacheSupport';
            var daoDao = 'I' + daoName + 'DAO';
            var daoDaoImpl = daoName + 'DAO';
            var daoTest = daoDaoImpl + 'Test';

            var poValue = pValue + '.data.po' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            var mapperValue = pValue + '.data.mapper' + (tablePack ? "." + tablePack : "");
            if (mapperValue.indexOf(".") === 0 && mapperValue.length > 1)
                mapperValue = mapperValue.substring(1);

            var jpaValue = pValue + '.data.jpa' + (tablePack ? "." + tablePack : "");
            if (jpaValue.indexOf(".") === 0 && jpaValue.length > 1)
                jpaValue = jpaValue.substring(1);

            var cacheValue = pValue + '.data.cache';
            if (cacheValue.indexOf(".") === 0 && cacheValue.length > 1)
                cacheValue = cacheValue.substring(1);

            var daoValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (daoValue.indexOf(".") === 0 && daoValue.length > 1)
                daoValue = daoValue.substring(1);

            var daoImplValue = daoValue + '.impl';
            if (daoImplValue.indexOf(".") === 0 && daoImplValue.length > 1)
                daoImplValue = daoImplValue.substring(1);

            var testValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (testValue.indexOf(".") === 0 && testValue.length > 1)
                testValue = testValue.substring(1);

            // set value
            this.poPackage().val(poValue);
            this.po().val(daoPO);
            this.mapperPackage().val(mapperValue);
            this.mapper().val(daoMapper);
            this.jpaPackage().val(jpaValue);
            this.jpa().val(daoJpa);
            this.daoCacheSupportPackage().val(cacheValue);
            this.daoCacheSupport().val(daoCacheSupport);
            this.daoPackage().val(daoValue);
            this.dao().val(daoDao);
            this.daoImplPackage().val(daoImplValue);
            this.daoImpl().val(daoDaoImpl);
            this.testPackage().val(testValue);
            this.test().val(daoTest);
        }
    };
</script>
<script type="text/javascript">
    var service = {
        _: function () {
            return $('input[name="service_"]');
        },
        // serviceDOPackage: function () {
        //     return $('input[name="serviceDOPackage"]');
        // },
        // serviceDO: function () {
        //     return $('input[name="serviceDO"]');
        // },
        serviceServicePackage: function () {
            return $('input[name="serviceServicePackage"]');
        },
        serviceService: function () {
            return $('input[name="serviceService"]');
        },
        serviceImplPackage: function () {
            return $('input[name="serviceServiceImplPackage"]');
        },
        serviceImpl: function () {
            return $('input[name="serviceServiceImpl"]');
        },
        serviceTestPackage: function () {
            return $('input[name="serviceServiceTestPackage"]');
        },
        serviceTest: function () {
            return $('input[name="serviceServiceTest"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var serviceName = tableName.replaceFirstUP();
            // var serviceDO = serviceName + "DO";
            var serviceService = 'I' + serviceName + "Service";
            var serviceServiceImpl = serviceName + "Service"
            var serviceServiceTest = serviceServiceImpl + "Test"

            // var sdValue = pValue + '.data.do_' + (tablePack ? "." + tablePack : "");
            // if (sdValue.indexOf(".") === 0 && sdValue.length > 1)
            //     sdValue = sdValue.substring(1);

            var ssValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (ssValue.indexOf(".") === 0 && ssValue.length > 1)
                ssValue = ssValue.substring(1);

            var ssiValue = ssValue + '.impl';
            if (ssiValue.indexOf(".") === 0 && ssiValue.length > 1)
                ssiValue = ssiValue.substring(1);

            var sstValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (sstValue.indexOf(".") === 0 && sstValue.length > 1)
                sstValue = sstValue.substring(1);

            // set value
            // this.serviceDOPackage().val(sdValue);
            // this.serviceDO().val(serviceDO);
            this.serviceServicePackage().val(ssValue);
            this.serviceService().val(serviceService);
            this.serviceImplPackage().val(ssiValue);
            this.serviceImpl().val(serviceServiceImpl);
            this.serviceTestPackage().val(sstValue);
            this.serviceTest().val(serviceServiceTest);
        }
    };

</script>
<script type="text/javascript">
    var web = {
        _: function () {
            return $('input[name="web_"]');
        },
        webVOPackage: function () {
            return $('input[name="webVOPackage"]');
        },
        webVO: function () {
            return $('input[name="webVO"]');
        },
        webControllerPackage: function () {
            return $('input[name="webControllerPackage"]');
        },
        webController: function () {
            return $('input[name="webController"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var webName = tableName.replaceFirstUP();
            var webVO = webName + "VO";
            var webController = webName + "Controller";

            var wvValue = pValue + '.data.vo' + (tablePack ? "." + tablePack : "");
            if (wvValue.indexOf(".") === 0 && wvValue.length > 1)
                wvValue = wvValue.substring(1);

            var wcValue = pValue + '.web.controller' + (tablePack ? "." + tablePack : "");
            if (wcValue.indexOf(".") === 0 && wcValue.length > 1)
                wcValue = wcValue.substring(1);

            // set value
            this.webVOPackage().val(wvValue);
            this.webVO().val(webVO);
            this.webControllerPackage().val(wcValue);
            this.webController().val(webController);
        }
    };
</script>
<script type="text/javascript">
    var generate = function () {
        $('#generate_form').form('nqcxSubmit', {
            url: "generator-api/generate/doit",
            onSubmit: function () {
                if (button.checkForm())
                    return $(this).form('validate');
                return false;
            },
            addDatas: {
                tableName: table.tableName().val(),
                tablePack: table.tablePack().val(),
                author: ws.author().val(),
                wsPath: ws.wsPath().val(),
                pName: project.pName().val(),
                pPath: project.pPath().val(),
                pPackage: project.pPackage().val(),
                pType: project.pType().filter(':checked').val(),
                provideModule: project.module.provide().val(),
                daoModule: project.module.dao().val(),
                serviceModule: project.module.service().val(),
                webModule: project.module.web().val()
            },
            success: function (result) {
                if (result.success) {
                    $.messager.show({
                        title: 'Success',
                        msg: '保存成功'
                    });
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.errorText
                    });
                }
            }
        });
    };

    $('#generate_btn').unbind('click').click(function () {
        generate();
    });
</script>
<script type="text/javascript">
    project.module.change = function () {
        provide.loadPackage();
        dao.loadPackage();
        service.loadPackage();
        web.loadPackage();
    };
    table.colPrefixChange = function () {
        // 重新加载表
        tableInfo.loadTable();
    };

    var abcd = function () {
        button.loadCenter().unbind('click').click(function () {
            table.change();
        });

        tableInfo.projectInit();
        provide.projectInit();
        dao.projectInit();
        service.projectInit();
        web.projectInit();
        console.log("Center loaded.")
    }

    $(document).ready(function () {
        abcd();
     });
</script>
