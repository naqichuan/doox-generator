<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta content="no-title" name="x5-page-mode">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <title>Doox code generator</title>
    <link rel="icon" type="image/png" href="webjars/doox-generator-ui/favicon.ico?v=1.2.0"/>
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/doox.css?v=1.2.0"/>
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/doox-generator.css?v=1.2.0"/>

    <link href="webjars/doox-generator-ui/themes/default/easyui.css" rel="stylesheet" type="text/css">
    <link href="webjars/doox-generator-ui/themes/icon.css" rel="stylesheet" type="text/css">
    <link href="webjars/doox-generator-ui/css/demo.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        #fileShow {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        #fileShow li {
            line-height: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        table td, table th {
            padding: 0 2px;
        }

        table td.lable {
            text-align: right;
        }

        input[type="text"] {
            width: 100px;
        }

        input[type="password"] {
            width: 100px;
        }

        input[type="text"].big {
            width: 120px;
        }

        input[type="text"].big_140 {
            width: 140px;
        }

        input[type="text"].big_180 {
            width: 180px;
        }

        input[type="text"].big_200 {
            width: 200px;
        }

        input[type="text"].big_240 {
            width: 240px;
        }

        input[type="text"].middle {
            width: 80px;
        }

        input[type="text"].small {
            width: 40px;
        }

        input[type="text"].waring {
            background-color: #FFFF00;
        }

        input[type="text"].error {
            background-color: #FF8888;
        }

        input[type="text"].right {
            text-align: right;
        }

        input[type="text"].readonly {
            border-top: none;
            border-left: none;
            border-right: none;
        }
    </style>
    <script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.easyui.nqcx.js"></script>
    <script type="text/javascript">
        // string
        String.prototype.compare = function (str) {
            return this.toLowerCase() === str.toLowerCase();
        };
        String.prototype.startWith = function (str) {
            if (str == null || str === '' || this.length === 0 || str.length > this.length)
                return false;
            return this.substr(0, str.length).compare(str);
        };
        String.prototype.endWith = function (str) {
            if (str == null || str === "" || this.length === 0 || str.length > this.length)
                return false;
            return this.substring(this.length - str.length) === str;
        };
        String.prototype.replaceFirstUP = function () {
            if (this.length === 0)
                return this;
            return this.replace(/\b(\w)|\s(\w)|(_\w)/g, function (m) {
                if (m.indexOf('_') > -1) {
                    return m.substring(m.indexOf('_') + 1).toUpperCase();
                } else
                    return m.toUpperCase();
            });
        };
        String.prototype.replaceFirstLow = function () {
            if (this.length === 0)
                return this;
            return this.replace(/\b(\w)|\s(\w)|(_\w)/g, function (m) {
                if (m.indexOf('_') > -1) {
                    return m.substring(m.indexOf('_') + 1).toLowerCase();
                } else
                    return m.toLowerCase();
            });
        };
        // end of string
    </script>
    <script type="text/javascript">
        var retryTimes = 1;
        var nqcxPost = function (url, data, callBack, errorCallBack) {
            $.post(url, data, function (result) {
                if (!result) {
                    $.messager.show({
                        title: 'Error',
                        msg: 'error'
                    });
                } else if (!result.success && result.errorCode === '11') {
                    if (retryTimes === 0) {
                        $.messager.show({
                            title: 'Error',
                            msg: result.errorText || 'error'
                        });
                    } else {
                        retryTimes--;
                        db.conn(connCallBack);
                    }
                } else {
                    retryTimes = 1;
                    if (callBack)
                        callBack(result);
                }
            }, 'json');
            var connCallBack = function () {
                nqcxPost(url, data, callBack);
            }
        };

        var nqcxGet = function (url, data, callBack) {
            if (url) {
                if (url.indexOf('?') === -1)
                    url += '?t=' + (new Date()).getTime();
                else
                    url += '&t=' + (new Date()).getTime();
            }

            $.get(url, data, function (result) {
                if (!result) {
                    $.messager.show({
                        title: 'Error',
                        msg: 'error'
                    });
                } else if (!result.success && result.errorCode === '11') {
                    if (retryTimes === 0) {
                        $.messager.show({
                            title: 'Error',
                            msg: result.errorText || 'error'
                        });
                    } else {
                        retryTimes--;
                        db.conn(connCallBack);
                    }
                } else {
                    retryTimes = 1;
                    if (callBack)
                        callBack(result);
                }
            }, 'json');
            var connCallBack = function () {
                nqcxGet(url, data, callBack);
            }
        };
    </script>
    <script type="text/javascript">
        // var ws = {
        //     author: function () {
        //         return $('input[name="author"]');
        //     },
        //     basedir: function () {
        //         return $('input[name="basedir"]');
        //     },
        //     saveAuthor: function () {
        //         var author = this.authorElement().val();
        //         if (!author)
        //             return;
        //
        //         nqcxPost("generator-api/ws/author", {author: author}, function (result) {
        //             if (result.success) {
        //                 console.log(result.object);
        //             }
        //         });
        //     },
        //     changeBasedir: function (callBack, errorCallBack) {
        //         var path = decodeURIComponent(this.basedirElement().val());
        //         if (!path)
        //             return;
        //
        //         nqcxPost("generator-api/ws/path/load", {"basedir": path}, function (result) {
        //             if (result.success && result.object) {
        //                 var wsdata = result.object;
        //                 if (wsdata.exists) {
        //                     ws.basedirExists = true;
        //                     ws.basedirExistsTip();
        //
        //                     $.messager.show({
        //                         title: 'Success',
        //                         msg: 'Ws _loaded'
        //                     });
        //
        //                     callBack(wsdata);
        //                 } else {
        //                     $.messager.show({
        //                         title: 'Error',
        //                         msg: 'WS 不存在！'
        //                     });
        //                     if (errorCallBack)
        //                         errorCallBack();
        //                 }
        //             } else {
        //                 $.messager.show({
        //                     title: 'Error',
        //                     msg: '加载 WS 错误！'
        //                 });
        //             }
        //         });
        //     },
        //     basedirExists: false,
        //     basedirExistsTip: function () {
        //         if (this.basedirExists) {
        //             this.basedirElement().removeClass("error");
        //         } else {
        //             this.basedirElement().addClass("error");
        //         }
        //     },
        //     reset: function () {
        //         var _this = this;
        //         nqcxGet('generator-api/project/info', {}, function (response) {
        //             if (response && response.success && response.object) {
        //                 var o = response.object;
        //
        //                 $.messager.show({
        //                     title: 'Success',
        //                     msg: 'Ws info _loaded'
        //                 });
        //
        //                 // 初始化 author 相关
        //                 ws.author().val(o.author);
        //                 // 初始化 worksapce 相关
        //                 ws.basedirElement().val(o.projectPath);
        //
        //                 _this.basedirExists = false;
        //                 _this.basedirExistsTip();
        //
        //                 project.emptyProjects();
        //
        //                 project.change();
        //
        //             } else {
        //                 $.messager.show({
        //                     title: 'Error',
        //                     msg: '加载 Ws info 错误！'
        //                 });
        //             }
        //         });
        //     }
        // }
    </script>
    <script type="text/javascript">
        var db = {
            jdbcUrl: function () {
                return $('input[name="jdbcUrl"]');
            },
            jdbcUser: function () {
                return $('input[name="jdbcUser"]');
            },
            jdbcPassword: function () {
                return $('input[name="jdbcPassword"]');
            },
            reset: function () {
                var _this = this;
                nqcxGet('generator-api/connection/info', {}, function (result) {
                    if (result.success && result.result) {
                        $.messager.show({
                            title: 'Success',
                            msg: 'Connection info loaded'
                        });

                        _this.jdbcUrl().val(result.result.jdbcUrl);
                        _this.jdbcUser().val(result.result.jdbcUser);
                        _this.jdbcPassword().val(result.result.jdbcPassword);
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: '加载 connection info 错误！'
                        });
                    }
                });
            },
            conn: function (callBack, errorCallBack) {
                $('#connForm').form('nqcxSubmit', {
                    url: "generator-api/connection/connect",
                    dataType: 'json',
                    onSubmit: function () {
                        return $(this).form('validate');
                    },
                    success: function (result) {
                        if (result.success) {
                            if (callBack)
                                callBack();
                        } else {
                            if (errorCallBack)
                                errorCallBack();
                            $.messager.show({
                                title: 'Error',
                                msg: result.errorText
                            });
                        }
                    },
                    error: function () {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Connect db fail! Please try again later.'
                        });
                    }
                });
            }
        };  // end of db

        var table = {
            tableName: function () {
                return $('select[name="tableName"]');
            },
            colPrefix: function () {
                return $('input[name="colPrefix"]');
            },
            tablePack: function () {
                return $('input[name="tablePack"]');
            },
            tablePackChanged: false,
            tablePackTip: function () {
                if (this.tablePackChanged) {
                    this.tablePack().addClass("waring");
                } else {
                    this.tablePack().removeClass("waring");
                }
            },
            reset: function () {
                this.tableName().val(this.tableName().attr('t-data'));
                this.colPrefix().val(this.colPrefix().attr('t-data'));
                this.tablePack().val(this.tablePack().attr('t-data'));
            },
            emptyTables: function () {
                $('select[name="tableName"] option').each(function () {
                    if ($(this).val()) {
                        $(this).remove();
                    }
                });
            },
            listNames: function () {
                // 取当前 table name
                var tableNameValue = table.tableName().val();
                var colPrefixValue = table.colPrefix().val();
                var tablePackValue = table.tablePack().val();

                var url = "generator-api/table/list";
                nqcxGet(url, {}, function (result) {
                    table.emptyTables();
                    if (result.list) {
                        for (t in result.list) {
                            table.listNamesAppend(result.list[t].name, result.list[t].name);
                        }
                    }
                    $.messager.show({
                        title: 'Success',
                        msg: 'Table loaded'
                    });

                    table.change(tableNameValue, colPrefixValue, tablePackValue);
                });
            },
            listNamesAppend: function (value, text) {
                $('<option value="' + value + '">' + text + '</option>').appendTo(this.tableName());
            },
            changeWatchers: [],
            change: function (lastTableName, lastColPrefixValue, lastTablePack) {
                var tableNameValue = this.tableName().val();
                if (!lastTableName && !tableNameValue) {
                    // 首次加载或选择了空值
                    tableNameValue = this.tableName().attr('t-data');
                } else if (lastTableName) {
                    // 点了 [Connect DB] 或 [>>Load tables>>]
                    tableNameValue = this.tableName().attr('t-data');
                    $('select[name="tableName"] option').each(function () {
                        if ($(this).val() && $(this).val() === lastTableName)
                            tableNameValue = lastTableName;
                    });
                }

                if (!tableNameValue) {
                    table.reset();
                    // center.clear();
                    return;
                }

                this.tableName().val(tableNameValue);
                if (!this.colPrefix().val())
                    this.colPrefix().val(this.colPrefix().attr('t-data'))
                if (!this.tablePackChanged)
                    this.tablePack().val(tableNameValue.replaceFirstLow());

                this.changeWatchers.forEach((item) => {
                    item();
                });
            }
        }; // end of table
    </script>

    <script type="text/javascript">
        var project = {
            authorElement: function () {
                return $('input[name="author"]');
            },
            basedirElement: function () {
                return $('input[name="basedir"]');
            },
            reloadProjectBtn: function () {
                return $('#reloadProjectBtn');
            },
            pName: function () {
                // return $('select[name="pName"]');
                return $('input[name="pName"]');
            },
            pPath: function () {
                return $('input[name="pPath"]');
            },
            pPackage: function () {
                return $('input[name="pPackage"]');
            },
            pType: function () {
                return $('input[name="pType"]');
            },
            author: '',
            authorChanged: false,
            authorChangedTip: function () {
                if (this.authorChanged)
                    this.authorElement().addClass("error");
                else
                    this.authorElement().removeClass("error");
            },
            loadAuthor: function () {
                var _this = this;
                nqcxPost("generator-api/project/author", {}, function (response) {
                    if (response.success) {
                        _this.author = response.object;
                        _this.authorElement().val(_this.author);
                        _this.authorChanged = false;
                        _this.authorChangedTip();
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Load author fail！'
                        });
                    }
                });
            },
            saveAuthor: function (author) {
                if (!author)
                    author = '';

                var _this = this;
                nqcxPost("generator-api/project/author/change", {author: author}, function (response) {
                    if (response.success) {
                        _this.author = response.object;
                        _this.authorElement().val(_this.author);
                        _this.authorChanged = false;
                        _this.authorChangedTip();
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Change author fail！'
                        });
                    }
                });
            },
            basedir: '',
            basedirChanged: false,
            basedirChangedTip: function () {
                if (this.basedirChanged)
                    this.basedirElement().addClass("error");
                else
                    this.basedirElement().removeClass("error");
            },
            loadBasedir: function (callback, errorCallback) {
                var _this = this;

                nqcxGet('generator-api/project/basedir', {}, function (response) {
                    if (response.success && response.object) {
                        _this.basedir = response.object;
                        _this.basedirElement().val(_this.basedir);

                        _this.basedirChanged = false;
                        _this.basedirChangedTip();

                        if (callback)
                            callback(_this.basedir);
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Load basedir fail！'
                        });

                        if (errorCallback)
                            errorCallback(_this.basedir);
                    }
                });
            },
            changeBasedir: function (basedir, callBack, errorCallBack) {
                var basedirDecode = decodeURIComponent(basedir);
                if (!basedirDecode)
                    return;

                var _this = this;
                nqcxPost("generator-api/project/basedir/change", {"basedir": basedirDecode}, function (response) {
                    if (response && response.success) {
                        _this.basedirChanged = false;
                        _this.basedirChangedTip();

                        if (callBack)
                            callBack(basedirDecode);
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Change basedir fail！'
                        });

                        if (errorCallBack)
                            errorCallBack(basedirDecode);
                    }
                });
            },
            _p: {}, // project
            _loaded: false,
            _init: function () {
                var _this = this;

                this.loadAuthor();
                this.loadBasedir(function (basedir) {
                    _this._load(basedir);
                });
            },
            _load: function (basedir) {
                var _this = this;
                _this._p = {};
                _this._loaded = false;

                var params = {};
                if (basedir)
                    params.basedir = basedir;

                nqcxGet('generator-api/project/info', params, function (response) {
                    if (response.success && response.object) {
                        _this._p = response.object;

                        //basedir
                        _this.basedir = _this._p.projectPath;
                        // name path type
                        _this.pName().val(_this._p.artifactId || _this._p.baseName);
                        _this.pPath().val(_this._p.projectPath);
                        _this.pType().val(_this._p.projectType);
                        // package
                        _this.pPackage().val(_this._p.groupId);
                        _this.pPackageChange();
                        _this.pPackageChanged = false;
                        _this.pPackageTip();

                        _this._loaded = true;

                        // modules
                        if (_this._p.modules)
                            _this.module.fillAll()
                        else
                            _this.module.emptyAll();

                        // change
                        _this._change();
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: 'Load project info fail！'
                        });
                    }
                });
            },
            _clear: function () {
                this._p = {};
                this._loaded = false;

                //  name path type
                this.pName().val('');
                this.pPath().val('');
                this.pType().val('');

                // package
                this.pPackage().val('');
                this.pPackageChange();
                this.pPackageChanged = false;
                this.pPackageTip();

                // modules
                this.module.emptyAll();

                path.setRelativePath('');
                path.loadCgFile('', []);
            },
            _change: function (callback) {
                var _this = this;

                // var pNameValue = _this.pName().val();
                // if (!pNameValue) {
                //     _this.clear();
                //     return;
                // }
                // // project path
                // _this.pPath().val('/' + pNameValue + '/');
                //
                // // project package
                // _this.pPackageChange(function () {
                //     // modules
                //     var pTypeValue = _this.pType().filter(':checked').val();
                //     if (pTypeValue === "Multiple")
                //         _this.fecthDirs(_this.module.fillAll);
                //     else
                //         _this.module.emptyAll();
                //
                //     // file path
                //     path.openFile();
                //
                //     if (callback)
                //         callback();
                // });

                // file path
                path.openFile();
            },
            pPackageChange: function () {
                // var _this = this;

                this.pPackageWatchers.forEach((item, index, array) => {
                    item();
                });

                // var ppName = this.pName().val();
                // if (ppName)
                //     ppName = ppName.replace("nqcx-", "").toLocaleLowerCase();
                // else
                //     ppName = "";
                //
                // // project package
                // var pPackageValue = _this.pPackage().val();

                // nqcxPost('generator-api/project/groupId', {
                //     basedir: _this.basedirElement().val(),
                //     pPath: project.pPath().val()
                // }, function (result) {
                //     if (!_this.pPackageChanged || !pPackageValue) {
                //         project.pPackageChanged = false; // 允许自动生成 pPackage
                //         project.pPackageTip();
                //
                //         pPackageValue = 'org.nqcx.' + ppName;
                //
                //         if (result.success && result.object)
                //             pPackageValue = result.object
                //     }
                //
                //     _this.pPackage().val(pPackageValue);
                //
                //     if (callback)
                //         callback();
                // });
            },
            pPackageChanged: false,
            pPackageTip: function () {
                if (this.pPackageChanged) {
                    this.pPackage().addClass("waring");
                } else {
                    this.pPackage().removeClass("waring");
                }
            },
            pPackageWatchers: [],

            // emptyProjects: function () {
            //     $('select[name="pName"] option').each(function () {
            //         if ($(this).val()) {
            //             $(this).remove();
            //         }
            //     });
            // },
            // loadProjects: function (wsdata) {
            //     this.emptyProjects();
            //
            //     var select = this.pName();
            //     var cList = wsdata.cgFileList;
            //     if (cList && cList.length > 0) {
            //         for (var idx in cList) {
            //             $('<option value="' + cList[idx].name + '">' + cList[idx].name + '</option>').appendTo(select);
            //         }
            //         $.messager.show({
            //             title: 'Success',
            //             msg: 'Projects _loaded'
            //         });
            //     }
            // },
            // dirList: null,
            // fecthDirs: function (callback) {
            //     var _this = this;
            //
            //     // clear array
            //     _this.dirList = [];
            //
            //     var basedir = _this.basedirElement().val();
            //     if (!_this.basedirExists || !basedir) {
            //         $.messager.show({
            //             title: 'Error',
            //             msg: 'WS not exists.'
            //         });
            //         return;
            //     }
            //
            //     var pPath = _this.pPath().val();
            //     if (!pPath) {
            //         $.messager.show({
            //             title: 'Error',
            //             msg: 'Please select project.'
            //         });
            //         return;
            //     }
            //
            //     var url = 'generator-api/project/openFile';
            //     nqcxPost(url, {basedir: basedir, pPath: pPath, path: '', name: ''}, function (result) {
            //         if (result.success && result.object.cgFileList) {
            //             var cgFileList = result.object.cgFileList;
            //             for (var idx in cgFileList) {
            //                 if (!cgFileList[idx].file)
            //                     _this.dirList.push(cgFileList[idx].name)
            //             }
            //             if (_this.dirList)
            //                 callback(_this);
            //         }
            //     });
            // },
            module: {
                provide: function () {
                    return $('select[name="provideModuleName"]');
                },
                dao: function () {
                    return $('select[name="daoModuleName"]');
                },
                service: function () {
                    return $('select[name="serviceModuleName"]');
                },
                web: function () {
                    return $('select[name="webModuleName"]');
                },
                fillAll: function () {
                    var _this = this;

                    _this.emptyAll();

                    // provide
                    _this.fill(_this.provide().attr("name"), project.pName().val() + '-provide');
                    // dao
                    _this.fill(_this.dao().attr("name"), project.pName().val() + '-dao');
                    // service
                    _this.fill(_this.service().attr("name"), project.pName().val() + '-service');
                    // web
                    _this.fill(_this.web().attr("name"), project.pName().val() + '-web');
                },
                fill: function (name, defaultModule) {
                    var _this = this;

                    var select = $('select[name="' + name + '"]');
                    var ml = project._p.modules;
                    for (var idx in ml) {
                        if (defaultModule && defaultModule === ml[idx])
                            $('<option selected="selected" value="' + ml[idx] + '">' + ml[idx] + '</option>').appendTo(select);
                        else
                            $('<option value="' + ml[idx] + '">' + ml[idx] + '</option>').appendTo(select);
                    }
                },
                emptyAll: function () {
                    // provide
                    this.empty(this.provide());
                    // dao
                    this.empty(this.dao());
                    // service
                    this.empty(this.service());
                    // web
                    this.empty(this.web());
                },
                empty: function (module) {
                    $('option', module).each(function () {
                        if ($(this).val()) {
                            $(this).remove();
                        }
                    });
                }
            }
        };  // end of project
    </script>
    <script type="text/javascript">
        var path = {
            relativePath: function () {
                return $('input[name="relativePath"]');
            },
            fileShow: function () {
                return $('#fileShow');
            },
            setRelativePath: function (value) {
                this.relativePath().val(value);
            },
            enterKeyDown: function (event) {
                if ((event.keyCode || event.which) === 13) {
                    event.preventDefault();

                    var relativePathValue = this.relativePath().val();

                    if (!relativePathValue)
                        relativePathValue = '/';

                    if (relativePathValue.indexOf('/') === -1)
                        relativePathValue = '/' + relativePathValue;

                    if (relativePathValue.length > 1 && relativePathValue.endWith('/'))
                        relativePathValue = relativePathValue.substring(0, relativePathValue.lastIndexOf('/'));

                    this.openFile(relativePathValue.substring(0, relativePathValue.lastIndexOf('/') + 1), relativePathValue.substring(relativePathValue.lastIndexOf('/') + 1, relativePathValue.length));
                }
            },
            openFile: function (pathValue, nameValue) {
                if (!project._loaded) {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Basedir not exists.'
                    });

                    return;
                }
                var basedir = project.basedir;

                // var _this = this;

                // var pPath = project.pPath().val();
                // if (!pPath) {
                //     $.messager.show({
                //         title: 'Error',
                //         msg: 'Please select project.'
                //     });
                //     return;
                // }

                if (!pathValue)
                    pathValue = '';
                if (!nameValue)
                    nameValue = '';

                var url = 'generator-api/project/openFile';
                nqcxPost(url, {
                    basedir: basedir,
                    // pPath: pPath,
                    path: pathValue,
                    name: nameValue
                }, function (result) {
                    var relativePathPath = '/';
                    var relativePathName = '';
                    var cgFileListValue = [];
                    if (result.success) {
                        if (result.object) {
                            relativePathPath = result.object.path;
                            relativePathName = result.object.name;
                        }
                        if (result.object.cgFileList)
                            cgFileListValue = result.object.cgFileList;
                    }
                    path.setRelativePath(relativePathPath + relativePathName);
                    path.loadCgFile(relativePathPath, cgFileListValue);
                });
            },
            loadCgFile: function (pathValue, cgFileList) {
                var cgFileHtml = '';
                if (pathValue)
                    cgFileHtml += '<li><a href="javascript:void(0);" onclick="path.openFile(\'' + pathValue + '\',\'\');">..</a></li>';
                for (var idx in cgFileList) {
                    if (cgFileList[idx].file)
                        cgFileHtml += '<li>' + cgFileList[idx].name + '</li>';
                    else
                        cgFileHtml += '<li><a href="javascript:void(0);" onclick="path.openFile(\'' + cgFileList[idx].path + '\',\'' + cgFileList[idx].name + '\');">' + cgFileList[idx].name + '</a></li>';
                }
                this.fileShow().html(cgFileHtml);
            }
        }; // end of path
    </script>
    <script type="text/javascript">
        // var center = {
        //     o: function () {
        //         return $('div#center');
        //     },
        //     load: function () {
        //
        //     },
        //     clear: function () {
        //     }
        // }; // end of center
    </script>
</head>
<body class="easyui-layout">
<div data-options="region:'north',split:true" style="height:75px;padding:5px 5px 0;overflow:hidden;">
    <form id="connForm" method="post" action="session">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr height="30px">
                <td class="lable">jdbc:mysql://</td>
                <td><input type="text" class="connectDB big_200" name="jdbcUrl" value=""></td>
                <td class="lable">User:</td>
                <td><input type="text" class="connectDB" name="jdbcUser" value=""/></td>
                <td class="lable">Password:</td>
                <td><input type="password" class="connectDB small" name="jdbcPassword" value="" autocomplete="off"/>
                </td>
                <td class="lable">
                    <input id="connectDB" type="button" value="Connect DB"/>
                </td>
            </tr>
            <tr height="30px">
                <td colspan="2">
                    <input id="loadTables" type="button" value=">>Load tables>>"/>
                    <select name="tableName" t-data="">
                        <option value="">Select Table</option>
                    </select>
                </td>
                <td class="lable">Col-prefix:</td>
                <td><input type="text" name="colPrefix" value="" t-data="t_,"/></td>
                <td class="lable">Table-pack:</td>
                <td><input type="text" name="tablePack" value="" t-data=""/></td>
                <td class="lable">
                    <input id="loadCenter" type="button" value="Load Center"/>
                </td>
            </tr>
        </table>
    </form>
</div>
<div data-options="region:'south',split:true" style="height:30px;"></div>
<div data-options="region:'west',split:true" style="width:230px;">
    <table border="0" cellpadding="0" cellspacing="0">
        <tr height="30">
            <td class="lable">
                Author:
            </td>
            <td>
                <input type="text" class="big_140" name="author" value=""/>
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">
                BaseDir:
            </td>
            <td>
                <input type="text" class="big_140" name="basedir" value=""/>
            </td>
        </tr>
        <tr height="30">
            <td colspan="2" style="text-align: center;">
                <input id="reloadProjectBtn" type="button" value="Reload Project"/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">
                Project:
            </td>
            <td>
                <!--<select name="pName">-->
                <!--<option value="">Select Project</option>-->
                <!--</select>-->
                <input type="text" class="big_140 readonly" name="pName" value="" readonly="true"/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Path:</td>
            <td><input type="text" class="big_140 readonly" name="pPath" value="" readonly="true"></td>
        </tr>
        <tr height="30">
            <td class="lable">Type:</td>
            <td>
                <!--<input type="radio" name="pType" value="Single"/>Single-->
                <!--<input type="radio" name="pType" value="Multiple" checked="checked"/>Multiple-->
                <input type="text" class="big_140 readonly" name="pType" value="" readonly="true">
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Package:</td>
            <td>
                <input type="text" class="waring big_140" name="pPackage" value="">
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Provide:</td>
            <td>
                <select name="provideModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">DAO:</td>
            <td>
                <select name="daoModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Service:</td>
            <td>
                <select name="serviceModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Web:</td>
            <td>
                <select name="webModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td colspan="2" style="padding-left: 10px">
                <strong>.</strong><input
                    type="text" class="big_180" name="relativePath" value=""/>
        </tr>
        <tr>
            <td colspan="2">
                <ul id="fileShow"></ul>
            </td>
        </tr>
    </table>
</div>
<div id="center" data-options="region:'center'" style="padding:5px;background:#eee;">
    <form id="generate_form" method="post" action="">
        <fieldset>
            <legend>
                <span style="font-weight: 700;">Table -> POJO</span>
            </legend>
            <table border="1" style="border-color: #6a6a6a;" cellpadding="0" cellspacing="0">
                <thead>
                <tr>
                    <th>field</th>
                    <th>type</th>
                    <th>collation</th>
                    <th>isNull</th>
                    <th>key</th>
                    <th>defaultValue</th>
                    <th>extra</th>
                    <th>privileges</th>
                    <th>comment</th>
                </tr>
                </thead>
                <tbody id="tableInfo">
                </tbody>
            </table>
            <div id="config_pojo_div"></div>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="provide_"
                                                       value="true">Module -> Provide</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="provideO_" value="true"></td>
                    <td class="lable">Create O:</td>
                    <td>
                        <input type="text" name="provideOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="provideO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="provideProvide_" value="true"></td>
                    <td class="lable">Create Provide:</td>
                    <td>
                        <input type="text" name="provideProvidePackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="provideProvide" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="dao_" value="true">Module -> Dao</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="daoPO_" value="true"></td>
                    <td class="lable">Create PO:</td>
                    <td>
                        <input type="text" name="daoPOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoPO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoMapper_" value="true"></td>
                    <td class="lable">Create Mapper:</td>
                    <td>
                        <input type="text" name="daoMapperPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoMapper" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoJpa_" value="true"></td>
                    <td class="lable">Create Jpa:</td>
                    <td>
                        <input type="text" name="daoJpaPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoJpa" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoCacheSupport_" value="true"></td>
                    <td class="lable">Create CacheSupport:</td>
                    <td>
                        <input type="text" name="daoCacheSupportPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoCacheSupport" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAO_" value="true"></td>
                    <td class="lable">Create DAO:</td>
                    <td>
                        <input type="text" name="daoDAOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAOImpl_" value="true"></td>
                    <td class="lable">Create DAOImpl:</td>
                    <td>
                        <input type="text" name="daoDAOImplPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAOImpl" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAOTest_" value="true"></td>
                    <td class="lable">Create DAOTest:</td>
                    <td>
                        <input type="text" name="daoDAOTestPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAOTest" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="service_"
                                                       value="true">Module -> Service</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceService_" value="true"></td>
                    <td class="lable">Create Service:</td>
                    <td>
                        <input type="text" name="serviceServicePackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceService" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceServiceImpl_" value="true"></td>
                    <td class="lable">Create ServiceImpl:</td>
                    <td>
                        <input type="text" name="serviceServiceImplPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceServiceImpl" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceServiceTest_" value="true"></td>
                    <td class="lable">Create ServiceTest:</td>
                    <td>
                        <input type="text" name="serviceServiceTestPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceServiceTest" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="web_" value="true">Module -> Web:</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="webVO_" value="true"></td>
                    <td class="lable">Create VO:</td>
                    <td>
                        <input type="text" name="webVOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="webVO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="webController_" value="true"></td>
                    <td class="lable">Create Controller:</td>
                    <td>
                        <input type="text" name="webControllerPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="webController" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/>
        <input id="generate_btn" type="button" value="Generate Code"
               style="width: 150px; height: 32px; background-color: orange;"/>
    </form>

</div>

<script src="webjars/doox-generator-ui/generator-ui.js?v=1.2.0"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // 初始化 db 相关值
        db.reset();
        // 初始化 table 相关
        table.reset();
        // 初始化 ws 相关
        project._init();

        // project.changeBasedir(function (wsdata) {
        //     project.loadProjects(wsdata);
        // }, function () {
        //     project.emptyProjects();
        //     project._clear();
        // });

        // Connect db and load table
        $('.connectDB').keyup(function (event) {
            if ((event.keyCode || event.which) === 13) {
                event.preventDefault();

                table.tablePackChanged = false; // 允许自动生成 table-pack
                table.tablePackTip();

                db.conn(table.listNames, function () {
                    table.reset();
                    table.emptyTables();
                    table.change();
                });
            }
        });
        $('#connectDB').click(function () {
            table.tablePackChanged = false; // 允许自动生成 table-pack
            table.tablePackTip();

            db.conn(table.listNames, function () {
                table.reset();
                table.emptyTables();
                table.change();
            });
        });

        $('#loadTables').click(function () {
            db.conn(table.listNames, function () {
                table.reset();
                table.emptyTables();
                table.change();
            });
        });
        // end of Connect...

        // table
        table.tableName().change(function () {
            table.change();
        });
        table.tablePack().change(function () {
            // child
            if (project.module.change)
                project.module.change();
        });
        table.tablePack().keyup(function () {
            table.tablePackChanged = true; // 手动变更，不允许自动生成 table-pack
            table.tablePackTip();
            // child
            if (project.module.change)
                project.module.change();
        });
        table.colPrefix().keyup(function () {
            if (table.colPrefixChange)
                table.colPrefixChange();
        });
        // end of table

        // project
        project.authorElement().keyup(function (event) {
            project.authorChanged = false;
            project.authorChangedTip();

            project.saveAuthor($(this).val());
        });
        project.reloadProjectBtn().click(function (event) {
            project._init();
        });
        project.basedirElement().keyup(function (event) {
            var basedir = $(this).val();

            project.basedirChanged = false;
            if (basedir !== project.basedir)
                project.basedirChanged = true;
            project.basedirChangedTip();

            project.changeBasedir(basedir, function (basedir) {
                project._load(basedir);
            }, function (basedir) {
                project._clear();
            });


            // project.pPackageChanged = false;
            // project.pPackageTip();

            // // child
            // if (project.module.change)
            //     project.module.change();

        }); // end of project

        // // project
        // project.pName().change(function () {
        //     project.change(function () {
        //         // child
        //         if (project.module.change)
        //             project.module.change();
        //     });
        // });
        // project.pType().change(function () {
        //     project.change(function () {
        //         // child
        //         if (project.module.change)
        //             project.module.change();
        //     });
        // });
        // project.pPackage().change(function () {
        //     // child
        // });
        project.pPackageWatchers.push(function () {
            if (project.module.change)
                project.module.change();
        });
        project.pPackage().keyup(function (e) {
            project.pPackageChanged = true; // 手动变更，不允许自动生成 pPackage
            project.pPackageTip();

            if (project.module.change)
                project.module.change();
        });
        // end of project

        path.relativePath().keydown(function (e) {
            path.enterKeyDown(e);
        });
    });
</script>
<script type="text/javascript">
    var button = {
        loadCenter: function () {
            return $('#loadCenter');
        },
        checkForm: function () {
            if (!ws.wsPathExists || !ws.wsPath().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'WS not exists.'
                });
                return false;
            } else if (!ws.author().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please input author.'
                });
                return false;
            } else if (!project.pName().val()) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please select project.'
                });
                return false;
            } else if (!provide._().is(":checked")
                && !dao._().is(":checked")
                && !service._().is(":checked")
                && !web._().is(":checked")) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Please select modules.'
                });
                return false;
            }
            return true;
        }
    };
</script>
<script type="text/javascript">
    var tableInfo = {
        projectDiv: function () {
            return $('#config_pojo_div');
        },
        info: function () {
            return $('tbody#tableInfo');
        },
        addInfo: function (columns) {
            if (!columns && columns.length === 0)
                return;
            this.info().html('');

            for (var idx in columns) {
                var colstr = '<tr>';
                colstr += '<td>' + columns[idx].field + '</td>';
                colstr += '<td>' + columns[idx].type + '</td>';
                colstr += '<td>' + columns[idx].collation + '</td>';
                colstr += '<td>' + columns[idx].isNull + '</td>';
                colstr += '<td>' + columns[idx].key + '</td>';
                colstr += '<td>' + columns[idx].defaultValue + '</td>';
                colstr += '<td>' + columns[idx].extra + '</td>';
                colstr += '<td>' + columns[idx].privileges + '</td>';
                colstr += '<td>' + columns[idx].comment + '</td>';
                colstr += '</tr>';

                this.info().append(colstr);
            }
        },
        projectInit: function () {
            this.loadTable()
        },
        loadTable: function () {
            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var columns = [];
            nqcxGet("generator-api/table/get/" + tableName, {}, function (result) {
                if (result.object && result.object.columns) {
                    columns = result.object.columns;
                }
                tableInfo.addInfo(columns);
                tableInfo.config(columns);
            });
        },
        config: function (columns) {
            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var tableHtml = '<hr />';
            tableHtml += '<table border="0" cellpadding="0" cellspacing="0">';
            for (idx in columns) {
                tableHtml += '<tr>' + this.row1(columns[idx]) + '</tr>';
            }
            tableHtml += '</table>';
            this.projectDiv().html(tableHtml);
        },
        row1: function (column) {
            var rowHtml = '';
            var field = column.field;
            var type = column.type;
            var field_ = this.toField(field);
            var type_ = this.toType(type);
            var show = 'private ' + type_ + ' ' + field_ + ";";

            rowHtml += '<td><input id="pojoColumn_' + field + '" type="text" name="pojoColumn" class="big_200" value="' + field + '" readonly="true" /></td>';
            rowHtml += '<td>' + type + '</td>';
            rowHtml += '<td><input id="pojoField_' + field + '" type="text" name="pojoField" class="big_200" value="' + field_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><input id="pojoType_' + field + '" type="text" name="pojoType" class="big" value="' + type_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><span id="jojoText_' + field + '">' + show + '</span></td>';

            return rowHtml;
        },
        show1: function (suffix) {
            var field_ = document.getElementById('pojoField_' + suffix).value;
            var type_ = document.getElementById('pojoType_' + suffix).value;
            var show1 = 'private ' + type_ + ' ' + field_ + ";";
            $('#jojoText_' + suffix).html(show1);
        },
        toField: function (input) {
            var prefix = table.colPrefix().val();
            var ps = prefix.split(',');
            if (ps != null && ps.length > 0) {
                for (var idx in ps) {
                    if (!ps[idx])
                        continue;
                    input = input.replace(new RegExp('^' + ps[idx], 'g'), '');
                }
            }
            return input.replaceFirstUP().replaceFirstLow();
        },
        toType: function (input) {
            if (input.startWith('bigint'))
                return "long";
            else if (input.startWith('int'))
                return "int";
            else if (input.startWith('tinyint'))
                return "int";
            else if (input.startWith('float'))
                return "float";
            else if (input.startWith('decimal'))
                return "BigDecimal";
            else if (input.startWith('varchar') || input.startWith('text'))
                return "String";
            else if (input.startWith('datetime') || input.startWith('date') || input.startWith('timestamp'))
                return "Date";
            else if (input.startWith('blob'))
                return "byte[]";
            else
                return input;
        }
    };
</script>
<script type="text/javascript">
    var provide = {
        _: function () {
            return $('input[name="provide_"]');
        },
        provideOPackage: function () {
            return $('input[name="provideOPackage"]');
        },
        provideO: function () {
            return $('input[name="provideO"]');
        },
        provideProvidePackage: function () {
            return $('input[name="provideProvidePackage"]');
        },
        provideProvide: function () {
            return $('input[name="provideProvide"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project package value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var provideName = tableName.replaceFirstUP();
            var provideO = provideName;
            var provideProvide = 'I' + provideName + 'Provide';

            var poValue = pValue + '.data.o' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            var ppValue = pValue + '.provide' + (tablePack ? "." + tablePack : "");
            if (ppValue.indexOf(".") === 0 && ppValue.length > 1)
                ppValue = ppValue.substring(1);

            // set value
            this.provideOPackage().val(poValue);
            this.provideO().val(provideO);

            this.provideProvidePackage().val(ppValue);
            this.provideProvide().val(provideProvide);
        }
    };
</script>
<script type="text/javascript">
    var dao = {
        _: function () {
            return $('input[name="dao_"]');
        },
        poPackage: function () {
            return $('input[name="daoPOPackage"]');
        },
        po: function () {
            return $('input[name="daoPO"]');
        },
        mapperPackage: function () {
            return $('input[name="daoMapperPackage"]');
        },
        mapper: function () {
            return $('input[name="daoMapper"]');
        },
        jpaPackage: function () {
            return $('input[name="daoJpaPackage"]');
        },
        jpa: function () {
            return $('input[name="daoJpa"]');
        },
        daoCacheSupportPackage: function () {
            return $('input[name="daoCacheSupportPackage"]');
        },
        daoCacheSupport: function () {
            return $('input[name="daoCacheSupport"]');
        },
        daoPackage: function () {
            return $('input[name="daoDAOPackage"]');
        },
        dao: function () {
            return $('input[name="daoDAO"]');
        },
        daoImplPackage: function () {
            return $('input[name="daoDAOImplPackage"]');
        },
        daoImpl: function () {
            return $('input[name="daoDAOImpl"]');
        },
        testPackage: function () {
            return $('input[name="daoDAOTestPackage"]');
        },
        test: function () {
            return $('input[name="daoDAOTest"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var daoName = tableName.replaceFirstUP();
            var daoPO = daoName + "PO";
            var daoMapper = 'I' + daoName + 'Mapper';
            var daoJpa = 'I' + daoName + 'Jpa';
            var daoCacheSupport = 'CacheSupport';
            var daoDao = 'I' + daoName + 'DAO';
            var daoDaoImpl = daoName + 'DAO';
            var daoTest = daoDaoImpl + 'Test';

            var poValue = pValue + '.data.po' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            var mapperValue = pValue + '.data.mapper' + (tablePack ? "." + tablePack : "");
            if (mapperValue.indexOf(".") === 0 && mapperValue.length > 1)
                mapperValue = mapperValue.substring(1);

            var jpaValue = pValue + '.data.jpa' + (tablePack ? "." + tablePack : "");
            if (jpaValue.indexOf(".") === 0 && jpaValue.length > 1)
                jpaValue = jpaValue.substring(1);

            var cacheValue = pValue + '.data.cache';
            if (cacheValue.indexOf(".") === 0 && cacheValue.length > 1)
                cacheValue = cacheValue.substring(1);

            var daoValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (daoValue.indexOf(".") === 0 && daoValue.length > 1)
                daoValue = daoValue.substring(1);

            var daoImplValue = daoValue + '.impl';
            if (daoImplValue.indexOf(".") === 0 && daoImplValue.length > 1)
                daoImplValue = daoImplValue.substring(1);

            var testValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (testValue.indexOf(".") === 0 && testValue.length > 1)
                testValue = testValue.substring(1);

            // set value
            this.poPackage().val(poValue);
            this.po().val(daoPO);
            this.mapperPackage().val(mapperValue);
            this.mapper().val(daoMapper);
            this.jpaPackage().val(jpaValue);
            this.jpa().val(daoJpa);
            this.daoCacheSupportPackage().val(cacheValue);
            this.daoCacheSupport().val(daoCacheSupport);
            this.daoPackage().val(daoValue);
            this.dao().val(daoDao);
            this.daoImplPackage().val(daoImplValue);
            this.daoImpl().val(daoDaoImpl);
            this.testPackage().val(testValue);
            this.test().val(daoTest);
        }
    };
</script>
<script type="text/javascript">
    var service = {
        _: function () {
            return $('input[name="service_"]');
        },
        // serviceDOPackage: function () {
        //     return $('input[name="serviceDOPackage"]');
        // },
        // serviceDO: function () {
        //     return $('input[name="serviceDO"]');
        // },
        serviceServicePackage: function () {
            return $('input[name="serviceServicePackage"]');
        },
        serviceService: function () {
            return $('input[name="serviceService"]');
        },
        serviceImplPackage: function () {
            return $('input[name="serviceServiceImplPackage"]');
        },
        serviceImpl: function () {
            return $('input[name="serviceServiceImpl"]');
        },
        serviceTestPackage: function () {
            return $('input[name="serviceServiceTestPackage"]');
        },
        serviceTest: function () {
            return $('input[name="serviceServiceTest"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var serviceName = tableName.replaceFirstUP();
            // var serviceDO = serviceName + "DO";
            var serviceService = 'I' + serviceName + "Service";
            var serviceServiceImpl = serviceName + "Service"
            var serviceServiceTest = serviceServiceImpl + "Test"

            // var sdValue = pValue + '.data.do_' + (tablePack ? "." + tablePack : "");
            // if (sdValue.indexOf(".") === 0 && sdValue.length > 1)
            //     sdValue = sdValue.substring(1);

            var ssValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (ssValue.indexOf(".") === 0 && ssValue.length > 1)
                ssValue = ssValue.substring(1);

            var ssiValue = ssValue + '.impl';
            if (ssiValue.indexOf(".") === 0 && ssiValue.length > 1)
                ssiValue = ssiValue.substring(1);

            var sstValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (sstValue.indexOf(".") === 0 && sstValue.length > 1)
                sstValue = sstValue.substring(1);

            // set value
            // this.serviceDOPackage().val(sdValue);
            // this.serviceDO().val(serviceDO);
            this.serviceServicePackage().val(ssValue);
            this.serviceService().val(serviceService);
            this.serviceImplPackage().val(ssiValue);
            this.serviceImpl().val(serviceServiceImpl);
            this.serviceTestPackage().val(sstValue);
            this.serviceTest().val(serviceServiceTest);
        }
    };

</script>
<script type="text/javascript">
    var web = {
        _: function () {
            return $('input[name="web_"]');
        },
        webVOPackage: function () {
            return $('input[name="webVOPackage"]');
        },
        webVO: function () {
            return $('input[name="webVO"]');
        },
        webControllerPackage: function () {
            return $('input[name="webControllerPackage"]');
        },
        webController: function () {
            return $('input[name="webController"]');
        },
        projectInit: function () {
            this.loadPackage();
        },
        loadPackage: function () {
            // project pakcage value
            var pValue = project.pPackage().val() || '';

            var tablePack = table.tablePack().val();

            var tableName = table.tableName().val();
            if (!tableName)
                return;

            var webName = tableName.replaceFirstUP();
            var webVO = webName + "VO";
            var webController = webName + "Controller";

            var wvValue = pValue + '.data.vo' + (tablePack ? "." + tablePack : "");
            if (wvValue.indexOf(".") === 0 && wvValue.length > 1)
                wvValue = wvValue.substring(1);

            var wcValue = pValue + '.web.controller' + (tablePack ? "." + tablePack : "");
            if (wcValue.indexOf(".") === 0 && wcValue.length > 1)
                wcValue = wcValue.substring(1);

            // set value
            this.webVOPackage().val(wvValue);
            this.webVO().val(webVO);
            this.webControllerPackage().val(wcValue);
            this.webController().val(webController);
        }
    };
</script>
<script type="text/javascript">
    var generate = function () {
        $('#generate_form').form('nqcxSubmit', {
            url: "generator-api/generate/doit",
            onSubmit: function () {
                if (button.checkForm())
                    return $(this).form('validate');
                return false;
            },
            addDatas: {
                tableName: table.tableName().val(),
                tablePack: table.tablePack().val(),
                author: ws.author().val(),
                wsPath: ws.wsPath().val(),
                pName: project.pName().val(),
                pPath: project.pPath().val(),
                pPackage: project.pPackage().val(),
                pType: project.pType().filter(':checked').val(),
                provideModule: project.module.provide().val(),
                daoModule: project.module.dao().val(),
                serviceModule: project.module.service().val(),
                webModule: project.module.web().val()
            },
            success: function (result) {
                if (result.success) {
                    $.messager.show({
                        title: 'Success',
                        msg: '保存成功'
                    });
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.errorText
                    });
                }
            }
        });
    };

    $('#generate_btn').unbind('click').click(function () {
        generate();
    });
</script>
<script type="text/javascript">
    project.module.change = function () {
        provide.loadPackage();
        dao.loadPackage();
        service.loadPackage();
        web.loadPackage();
    };
    table.colPrefixChange = function () {
        // 重新加载表
        tableInfo.loadTable();
    };

    table.changeWatchers.push(function () {
        button.loadCenter().unbind('click').click(function () {
            table.change();
        });

        tableInfo.projectInit();
        provide.projectInit();
        dao.projectInit();
        service.projectInit();
        web.projectInit();
        console.log("Center loaded.")
    });
</script>
</body>
</html>
