<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta content="no-title" name="x5-page-mode">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <title>Doox code generator</title>
    <link rel="icon" type="image/png" href="webjars/doox-generator-ui/favicon.ico?v=1.2.0"/>
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/css/demo.css">
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/css/doox.css?v=1.2.0"/>
    <link rel="stylesheet" type="text/css" href="webjars/doox-generator-ui/css/doox-generator.css?v=1.2.0"/>
</head>
<body class="easyui-layout">
<div data-options="region:'north',split:true" style="height:75px;padding:5px 5px 0;overflow:hidden;">
    <form id="connForm" method="post" action="session">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr height="30px" id="connbg">
                <td>
                    <input id="connectDB" type="button" value=">> Connect DB >>"/>
                    jdbc:mysql://<input type="text" class="connectDB big_200" name="jdbcUrl" value="">
                </td>
                <td class="lable">User:</td>
                <td><input type="text" class="connectDB" name="jdbcUser" value=""/></td>
                <td class="lable">Password:</td>
                <td>
                    <input type="password" class="connectDB small" name="jdbcPassword" value="" autocomplete="off"/>
                </td>
            </tr>
            <tr height="30px">
                <td>
                    <input id="loadTables" type="button" value=">> Load tables >>"/>
                    <select name="tableName" t-data="">
                        <option value="">Select Table</option>
                    </select>
                </td>
                <td class="lable">Col-prefix:</td>
                <td><input type="text" name="colPrefix" value="" t-data="t_,"/></td>
                <td class="lable">Table-pack:</td>
                <td><input type="text" name="tablePack" value="" t-data=""/></td>
            </tr>
        </table>
    </form>
</div>
<div data-options="region:'south',split:true" style="height:30px;line-height: 24px;text-align: center;"><span>&copy 2020 By Naqichuan</span>
</div>
<div data-options="region:'west',split:true" style="width:230px;">
    <table border="0" cellpadding="0" cellspacing="0">
        <tr height="30">
            <td class="lable">
                Author:
            </td>
            <td>
                <input type="text" class="big_140" name="author" value=""/>
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">
                BaseDir:
            </td>
            <td>
                <input type="text" class="big_140" name="basedir" value=""/>
            </td>
        </tr>
        <tr height="30">
            <td colspan="2" style="text-align: center;">
                <input id="reloadProjectBtn" type="button" value="Reload Project"/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">
                Project:
            </td>
            <td>
                <input type="text" class="big_140 readonly" name="pName" value="" readonly="true"/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Path:</td>
            <td><input type="text" class="big_140 readonly" name="pPath" value="" readonly="true"></td>
        </tr>
        <tr height="30">
            <td class="lable">Type:</td>
            <td>
                <!--<input type="radio" name="pType" value="Single"/>Single-->
                <!--<input type="radio" name="pType" value="Multiple"/>Multiple-->
                <input type="text" class="big_140 readonly" name="pType" value="" readonly="true">
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Package:</td>
            <td>
                <input type="text" class="waring big_140" name="pPackage" value="">
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Api:</td>
            <td>
                <select name="apiModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">DAO:</td>
            <td>
                <select name="daoModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Service:</td>
            <td>
                <select name="serviceModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">Web:</td>
            <td>
                <select name="webModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="30">
            <td class="lable">UI:</td>
            <td>
                <select name="uiModuleName">
                    <option value="">/</option>
                </select>
            </td>
        </tr>
        <tr height="10">
            <td colspan="2">
                <hr/>
            </td>
        </tr>
        <tr height="30">
            <td colspan="2" style="padding-left: 10px">
                <strong>.</strong><input
                    type="text" class="big_180" name="relativePath" value=""/>
        </tr>
        <tr>
            <td colspan="2">
                <ul id="fileShow"></ul>
            </td>
        </tr>
    </table>
</div>
<div id="center" data-options="region:'center'" style="padding:5px;background:#eee;">
    <form id="generate_form" method="post" action="">
        <fieldset>
            <legend>
                <span style="font-weight: 700;">Table -> POJO</span>
            </legend>
            <table border="1" style="border-color: #6a6a6a;" cellpadding="0" cellspacing="0">
                <thead>
                <tr>
                    <th>field</th>
                    <th>type</th>
                    <th>collation</th>
                    <th>isNull</th>
                    <th>key</th>
                    <th>defaultValue</th>
                    <th>extra</th>
                    <th>privileges</th>
                    <th>comment</th>
                </tr>
                </thead>
                <tbody id="tableInfo">
                </tbody>
            </table>
            <div id="config_pojo_div"></div>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="api_" value="true">Module -> Api</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="apiDTO_" value="true"></td>
                    <td class="lable">DTO</td>
                    <td class="lable"><input type="checkbox" name="apiDTOOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="apiDTOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="apiDTO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="apiApi_" value="true"></td>
                    <td class="lable" style="background-color: #008000;">Api</td>
                    <td class="lable" style="background-color: #008000;"><input type="checkbox" name="apiApiOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="apiApiPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="apiApi" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="dao_" value="true">Module -> Dao</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="daoPO_" value="true"></td>
                    <td class="lable">PO</td>
                    <td class="lable"><input type="checkbox" name="daoPOOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoPOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoPO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoMapper_" value="true"></td>
                    <td class="lable">Mapper</td>
                    <td class="lable"><input type="checkbox" name="daoMapperOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoMapperPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoMapper" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoMapperXml_" value="true"></td>
                    <td class="lable">MapperXml</td>
                    <td class="lable"><input type="checkbox" name="daoMapperXmlOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoMapperXmlPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoMapperXml" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoJpa_" value="true"></td>
                    <td class="lable" style="background-color: #008000;">Jpa</td>
                    <td class="lable" style="background-color: #008000;"><input type="checkbox" name="daoJpaOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoJpaPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoJpa" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoCacheSupport_" value="true"></td>
                    <td class="lable" style="background-color: #008000;">CacheSupport</td>
                    <td class="lable" style="background-color: #008000;"><input type="checkbox" name="daoCacheSupportOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoCacheSupportPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoCacheSupport" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAO_" value="true"></td>
                    <td class="lable">DAO</td>
                    <td class="lable"><input type="checkbox" name="daoDAOOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoDAOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAOImpl_" value="true"></td>
                    <td class="lable">DAOImpl</td>
                    <td class="lable"><input type="checkbox" name="daoDAOImplOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoDAOImplPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAOImpl" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="daoDAOTest_" value="true"></td>
                    <td class="lable">DAOTest</td>
                    <td class="lable"><input type="checkbox" name="daoDAOTestOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="daoDAOTestPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="daoDAOTest" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="service_" value="true">Module -> Service</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceVO_" value="true"></td>
                    <td class="lable">VO</td>
                    <td class="lable"><input type="checkbox" name="serviceVOOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="serviceVOPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceVO" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceService_" value="true"></td>
                    <td class="lable">Service</td>
                    <td class="lable"><input type="checkbox" name="serviceServiceOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="serviceServicePackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceService" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceServiceImpl_" value="true"></td>
                    <td class="lable">ServiceImpl</td>
                    <td class="lable"><input type="checkbox" name="serviceServiceImplOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="serviceServiceImplPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceServiceImpl" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="serviceServiceTest_" value="true"></td>
                    <td class="lable">ServiceTest</td>
                    <td class="lable"><input type="checkbox" name="serviceServiceTestOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="serviceServiceTestPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="serviceServiceTest" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="web_" value="true">Module -> Web:</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="webApiController_" value="true"></td>
                    <td class="lable">Controller</td>
                    <td class="lable"><input type="checkbox" name="webApiControllerOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="webApiControllerPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="webApiController" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="webCloudapi_" value="true"></td>
                    <td class="lable">Cloudapi</td>
                    <td class="lable"><input type="checkbox" name="webCloudapiOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="webCloudapiPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="webCloudapi" class="big_200" value="">
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="webOpenapi_" value="true"></td>
                    <td class="lable">Openapi</td>
                    <td class="lable"><input type="checkbox" name="webOpenapiOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="webOpenapiPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="webOpenapi" class="big_200" value="">
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/> <br/>
        <fieldset>
            <legend>
                <span style="font-weight: 700;"><input type="checkbox" name="ui_" value="true">Module -> UI:</span>
            </legend>
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td class="lable"><input type="checkbox" name="uiApi_" value="true"></td>
                    <td class="lable">UI api</td>
                    <td class="lable"><input type="checkbox" name="uiApiOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="uiApiPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="uiApi" class="big_200" value="">.js
                    </td>
                </tr>
                <tr>
                    <td class="lable"><input type="checkbox" name="uiView_" value="true"></td>
                    <td class="lable">UI view</td>
                    <td class="lable"><input type="checkbox" name="uiViewOverwrite_" value="true">Overwrite: </td>
                    <td>
                        <input type="text" name="uiViewPackage" class="big_240 right" value="">
                    </td>
                    <td class="lable">.</td>
                    <td>
                        <input type="text" name="uiView" class="big_200" value="">.vue
                    </td>
                </tr>
            </table>
        </fieldset>
        <br/>
        <input id="generate_btn" type="button" value="Generate Code"
               style="width: 150px; height: 32px; background-color: orange;"/>
    </form>
</div>
<script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.min.js"></script>
<script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.easyui.min.js"></script>
<script type="text/javascript" src="webjars/doox-generator-ui/jquery/jquery.easyui.nqcx.js"></script>
<script type="text/javascript" src="webjars/doox-generator-ui/js/doox-generator.js?v=1.2.0"></script>
<script type="text/javascript">
    let db = {
        connbg: function () {
            return $('#connbg');
        },
        jdbcUrl: function () {
            return $('input[name="jdbcUrl"]');
        },
        jdbcUser: function () {
            return $('input[name="jdbcUser"]');
        },
        jdbcPassword: function () {
            return $('input[name="jdbcPassword"]');
        },
        conned: false,
        connChanged: false,
        connTip: function () {
            if (!this.conned || this.connChanged)
                this.connbg().addClass("error");
            else
                this.connbg().removeClass("error");
        },
        connWatchers: [],
        _init: function () {
            this.conned = false;
            this.connChanged = false;
            this.connTip();

            let _this = this;
            nqcxGet('generator-api/connection/info', {}, function (result) {
                if (result.success && result.results) {
                    _this.jdbcUrl().val(result.results.jdbcUrl);
                    _this.jdbcUser().val(result.results.jdbcUser);
                    _this.jdbcPassword().val(result.results.jdbcPassword);
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Load connection info fail！'
                    });
                }
            });
        },
        conn: function (onlyConnect) {
            let _this = this;

            _this.conned = false;
            _this.connChanged = true;
            _this.connTip();

            $('#connForm').form('nqcxSubmit', {
                url: "generator-api/connection/connect",
                dataType: 'json',
                onSubmit: function () {
                    return $(this).form('validate');
                },
                success: function (response) {
                    if (response && response.success) {
                        _this.conned = true;
                        _this.connChanged = false;
                        _this.connTip();

                        if (onlyConnect) {
                            $.messager.show({
                                title: 'Success',
                                msg: 'Connected.'
                            });
                        }
                    } else {
                        $.messager.show({
                            title: 'Error',
                            msg: response.errorText || 'error'
                        });
                    }

                    if (!onlyConnect) {
                        _this.connWatchers.forEach((watcher) => {
                            watcher();
                        });
                    }
                },
                error: function () {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Connect db fail! Please try again later.'
                    });

                    if (!onlyConnect) {
                        _this.connWatchers.forEach((watcher) => {
                            watcher();
                        });
                    }
                }
            });
        }
    };  // end of db

    // 注册重连方法
    nqcxPost.retryConnect = db.conn;
    nqcxGet.retryConnect = db.conn;

    // Connect db and load table
    $('.connectDB').keyup(function (event) {
        //shift 16, control 17, alt 18, meta 91
        db.connChanged = (event.which !== 16 && event.which !== 17 && event.which !== 18 && event.which !== 91);
        db.connTip();

        if ((event.keyCode || event.which) === 13) {
            event.preventDefault();
            db.conn(event.shiftKey);
        }
    });
    $('#connectDB').click(function () {
        db.conn();
    });
</script>
<script type="text/javascript">
    // table
    let table = {
        tableName: function () {
            return $('select[name="tableName"]');
        },
        colPrefix: function () {
            return $('input[name="colPrefix"]');
        },
        tablePack: function () {
            return $('input[name="tablePack"]');
        },
        _init: function () {
            this.tableName().val(this.tableName().attr('t-data'));
            this.tableNameWatchers.forEach((watcher) => {
                watcher();
            });

            this.colPrefixReset();
            this.tablePackReset();
        },
        _reset: function () {
            this.emptyTables();
            this._init();
        },
        _reload: function () {
            // 取当前 table name
            let tableNameValue = this.tableName().val();
            let colPrefixValue = this.colPrefix().val();
            let tablePackValue = this.tablePack().val();

            this.emptyTables();
            this._init();

            this.loadTables(tableNameValue, colPrefixValue, tablePackValue);
        },
        tableNameWatchers: [],
        emptyTables: function () {
            $('select[name="tableName"] option').each(function () {
                if ($(this).val()) {
                    $(this).remove();
                }
            });
        },
        loadTables: function (tableNameValue, colPrefixValue, tablePackValue) {
            let _this = this;
            nqcxGet("generator-api/table/list", {}, function (response) {
                if (response.success && response.list && response.list instanceof Array) {
                    response.list.forEach((item) => {
                        _this.loadTablesAppend(item.name, item.name);
                    });

                    $.messager.show({
                        title: 'Success',
                        msg: 'Table loaded.'
                    });
                } else {
                    $.messager.show({
                        title: 'Success',
                        msg: 'Table load fail!'
                    });
                }

                _this.changeTable(tableNameValue, colPrefixValue, tablePackValue);
            });
        },
        loadTablesAppend: function (value, text) {
            $('<option value="' + value + '">' + text + '</option>').appendTo(this.tableName());
        },
        changeTable(lastTableName, lastColPrefixValue, lastTablePackValue) {
            $('select[name="tableName"] option').each(function () {
                let value = $(this).val();
                if (lastTableName && lastTableName === value) {
                    $(this).prop("selected", true);
                }
            });

            let tableNameValue = this.tableName().val() || this.tableName().attr('t-data');
            this.tableNameWatchers.forEach((watcher) => {
                watcher();
            });

            if (!this.colPrefixChanged)
                this.colPrefix().val(this.colPrefix().attr('t-data'));
            this.colPrefixWatchers.forEach((watcher) => {
                watcher();
            });

            if (!this.tablePackChanged && tableNameValue)
                this.tablePack().val(tableNameValue.replaceAll('_', '.'));
            this.tablePackWatchers.forEach((watcher) => {
                watcher();
            });
        },
        colPrefixChanged: false,
        colPrefixTip: function () {
            if (this.colPrefixChanged) {
                this.colPrefix().addClass("waring");
            } else {
                this.colPrefix().removeClass("waring");
            }
        },
        colPrefixReset: function () {
            this.colPrefix().val(this.colPrefix().attr('t-data'));
            this.colPrefixChanged = false;
            this.colPrefixTip();

            this.colPrefixWatchers.forEach((watcher) => {
                watcher();
            });
        },
        colPrefixWatchers: [],
        colPrefixChange: function () {
            this.colPrefixWatchers.forEach((watcher) => {
                watcher();
            });
        },
        tablePackChanged: false,
        tablePackTip: function () {
            if (this.tablePackChanged) {
                this.tablePack().addClass("waring");
            } else {
                this.tablePack().removeClass("waring");
            }
        },
        tablePackReset: function () {
            this.tablePack().val(this.tablePack().attr('t-data'));
            this.tablePackChanged = false;
            this.tablePackTip();

            let tableNameValue = this.tableName().val() || this.tableName().attr('t-data');
            this.tablePack().val(tableNameValue.replaceAll('_', '.'));

            this.tablePackWatchers.forEach((watcher) => {
                watcher();
            });
        },
        tablePackWatchers: [],
        tablePackChange: function () {
            this.tablePackWatchers.forEach((watcher) => {
                watcher();
            });
        }
    }; // end of table

    // 注册 watcher
    db.connWatchers.push(() => {
        if (!db.conned)
            table._reset();
        else
            table._reload();
    });

    // 注册事件
    $('#loadTables').click(() => db.conn());

    table.tableName().change(() => table.changeTable());
    table.colPrefix().keyup(() => {
        table.colPrefixChanged = true;
        table.colPrefixTip();
        table.colPrefixChange();

        if ((event.keyCode || event.which) === 13) {
            if (!table.colPrefix().val()) {
                table.colPrefixReset();
            }
        }
    });
    table.tablePack().keyup(() => {
        table.tablePackChanged = true;
        table.tablePackTip();
        table.tablePackChange();

        if ((event.keyCode || event.which) === 13) {
            if (!table.tablePack().val()) {
                table.tablePackReset();
            }
        }
    });
</script>
<script type="text/javascript">
    let project = {
        authorElement: function () {
            return $('input[name="author"]');
        },
        basedirElement: function () {
            return $('input[name="basedir"]');
        },
        reloadProjectBtn: function () {
            return $('#reloadProjectBtn');
        },
        pName: function () {
            return $('input[name="pName"]');
        },
        pPath: function () {
            return $('input[name="pPath"]');
        },
        pPackage: function () {
            return $('input[name="pPackage"]');
        },
        pType: function () {
            return $('input[name="pType"]');
        },
        author: '',
        authorChanged: false,
        authorChangedTip: function () {
            if (this.authorChanged)
                this.authorElement().addClass("error");
            else
                this.authorElement().removeClass("error");
        },
        loadAuthor: function () {
            let _this = this;
            nqcxPost("generator-api/project/author", {}, function (response) {
                if (response.success) {
                    _this.author = response.object;
                    _this.authorElement().val(_this.author);
                    _this.authorChanged = false;
                    _this.authorChangedTip();
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Load author fail！'
                    });
                }
            });
        },
        saveAuthor: function (author) {
            if (!author)
                author = '';

            let _this = this;
            nqcxPost("generator-api/project/author/change", {author: author}, function (response) {
                if (response.success) {
                    _this.author = response.object;
                    _this.authorElement().val(_this.author);
                    _this.authorChanged = false;
                    _this.authorChangedTip();
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Change author fail！'
                    });
                }
            });
        },
        basedir: '',
        basedirChanged: false,
        basedirChangedTip: function () {
            if (this.basedirChanged)
                this.basedirElement().addClass("error");
            else
                this.basedirElement().removeClass("error");
        },
        loadBasedir: function (callback, errorCallback) {
            let _this = this;

            nqcxGet('generator-api/project/basedir', {}, function (response) {
                if (response.success && response.object) {
                    _this.basedir = response.object;
                    _this.basedirElement().val(_this.basedir);

                    _this.basedirChanged = false;
                    _this.basedirChangedTip();

                    if (callback)
                        callback(_this.basedir);
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Load basedir fail！'
                    });

                    if (errorCallback)
                        errorCallback(_this.basedir);
                }
            });
        },
        changeBasedir: function (basedir, callBack, errorCallBack) {
            let basedirDecode = decodeURIComponent(basedir);
            if (!basedirDecode)
                return;

            let _this = this;
            nqcxPost("generator-api/project/basedir/change", {"basedir": basedirDecode}, function (response) {
                if (response && response.success) {
                    _this.basedirChanged = false;
                    _this.basedirChangedTip();

                    if (callBack)
                        callBack(basedirDecode);
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Change basedir fail！'
                    });

                    if (errorCallBack)
                        errorCallBack(basedirDecode);
                }
            });
        },
        _p: {}, // project
        _loaded: false,
        _init: function () {
            let _this = this;

            this.loadAuthor();
            this.loadBasedir(function (basedir) {
                _this._load(basedir);
            });
        },
        _load: function (basedir) {
            let _this = this;
            _this._p = {};
            _this._loaded = false;

            let params = {};
            if (basedir)
                params.basedir = basedir;

            nqcxGet('generator-api/project/info', params, function (response) {
                if (response.success && response.object) {
                    _this._p = response.object;

                    //basedir
                    _this.basedir = _this._p.basedir;
                    // name path type
                    _this.pName().val(_this._p.artifactId || _this._p.baseName);
                    _this.pPath().val(_this._p.projectPath);
                    _this.pType().val(_this._p.projectType);
                    // package
                    _this.pPackage().val(_this._p.groupId);
                    _this.pPackageChange();
                    _this.pPackageChanged = false;
                    _this.pPackageTip();

                    _this._loaded = true;

                    // modules
                    if (_this._p && _this._p.modules)
                        _this.module.fillAllModules();
                    else
                        _this.module.emptyAllModules();
                    // folders
                    if (_this._p && _this._p.folders)
                        _this.module.fillAllFolders();
                    else
                        _this.module.emptyAllFolders();


                    // change
                    _this._change();
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: 'Load project info fail！'
                    });
                }
            });
        },
        _clear: function () {
            this._p = {};
            this._loaded = false;

            //  name path type
            this.pName().val('');
            this.pPath().val('');
            this.pType().val('');

            // package
            this.pPackage().val('');
            this.pPackageChange();
            this.pPackageChanged = false;
            this.pPackageTip();

            // modules
            this.module.emptyAllModules();
            // folders
            this.module.emptyAllFolders()

            path.setRelativePath('');
            path.loadCgFile('', []);
        },
        _change: function () {
            path.openFile();
        },
        pPackageChange: function () {
            this.pPackageWatchers.forEach((watcher) => {
                watcher();
            });
        },
        pPackageChanged: false,
        pPackageTip: function () {
            if (this.pPackageChanged) {
                this.pPackage().addClass("waring");
            } else {
                this.pPackage().removeClass("waring");
            }
        },
        pPackageReset: function () {
            this.pPackage().val(this._p.groupId);
            this.pPackageChanged = false;
            this.pPackageTip();

            this.pPackageWatchers.forEach((watcher) => {
                watcher();
            });
        },
        pPackageWatchers: [],
        module: {
            api: function () {
                return $('select[name="apiModuleName"]');
            },
            dao: function () {
                return $('select[name="daoModuleName"]');
            },
            service: function () {
                return $('select[name="serviceModuleName"]');
            },
            web: function () {
                return $('select[name="webModuleName"]');
            },
            ui: function () {
                return $('select[name="uiModuleName"]');
            },
            fillAllModules: function () {
                let _this = this;

                _this.emptyAllModules();

                // api
                _this.fill(_this.api().attr("name"), '-api', project._p.modules);
                // dao
                _this.fill(_this.dao().attr("name"), '-dao', project._p.modules);
                // service
                _this.fill(_this.service().attr("name"), '-service', project._p.modules);
                // web
                _this.fill(_this.web().attr("name"), '-web', project._p.modules);
            },
            fillAllFolders: function () {
                let _this = this;

                _this.emptyAllFolders();

                // ui
                _this.fill(_this.ui().attr("name"), '-ui', project._p.folders);
            },
            fill: function (name, defaultModule, ml) {
                let select = $('select[name="' + name + '"]');
                for (let idx in ml) {
                    if(ml.hasOwnProperty(idx)) {
                        if (defaultModule && ml[idx].indexOf(defaultModule) > -1)
                            $('<option selected="selected" value="' + ml[idx] + '">' + ml[idx] + '</option>').appendTo(select);
                        else
                            $('<option value="' + ml[idx] + '">' + ml[idx] + '</option>').appendTo(select);
                    }
                }
            },
            emptyAllModules: function () {
                // api
                this.empty(this.api());
                // dao
                this.empty(this.dao());
                // service
                this.empty(this.service());
                // web
                this.empty(this.web());
            },
            emptyAllFolders: function () {
                // ui
                this.empty(this.ui());
            },
            empty: function (module) {
                $('option', module).each(function () {
                    if ($(this).val()) {
                        $(this).remove();
                    }
                });
            },
            changeWatchars: [],
            change: function () {
                this.changeWatchars.forEach((watcher) => {
                    watcher();
                });
            }
        }
    };  // end of project

    // table
    table.tablePackWatchers.push(function () {
        project.module.change();
    });

    // project
    project.authorElement().keyup(function (event) {
        project.authorChanged = true;
        project.authorChangedTip();

        project.saveAuthor($(this).val());
    });
    project.reloadProjectBtn().click(function (event) {
        project._init();
    });
    project.basedirElement().keyup(function (event) {
        let basedir = $(this).val();

        project.basedirChanged = false;
        if (basedir !== project.basedir)
            project.basedirChanged = true;
        project.basedirChangedTip();

        project.changeBasedir(basedir, function (basedir) {
            project._load(basedir);
        }, function (basedir) {
            project._clear();
        });
    });

    project.pPackageWatchers.push(() => project.module.change());

    project.pPackage().keyup((event) => {
        project.pPackageChanged = true;
        project.pPackageTip();
        project.pPackageChange();

        if ((event.keyCode || event.which) === 13) {
            if (!project.pPackage().val()) {
                project.pPackageReset();
            }
        }
    });
</script>
<script type="text/javascript">
    let path = {
        relativePath: function () {
            return $('input[name="relativePath"]');
        },
        fileShow: function () {
            return $('#fileShow');
        },
        setRelativePath: function (value) {
            this.relativePath().val(value);
        },
        enterKeyDown: function (event) {
            if ((event.keyCode || event.which) === 13) {
                event.preventDefault();

                let relativePathValue = this.relativePath().val();

                if (!relativePathValue)
                    relativePathValue = '/';

                if (relativePathValue.indexOf('/') === -1)
                    relativePathValue = '/' + relativePathValue;

                if (relativePathValue.length > 1 && relativePathValue.endWith('/'))
                    relativePathValue = relativePathValue.substring(0, relativePathValue.lastIndexOf('/'));

                this.openFile(relativePathValue.substring(0, relativePathValue.lastIndexOf('/') + 1), relativePathValue.substring(relativePathValue.lastIndexOf('/') + 1, relativePathValue.length));
            }
        },
        openFile: function (pathValue, nameValue) {
            if (!project._loaded) {
                $.messager.show({
                    title: 'Error',
                    msg: 'Basedir not exists.'
                });

                return;
            }
            let basedir = project.basedirElement().val();

            if (!pathValue)
                pathValue = '';
            if (!nameValue)
                nameValue = '';

            let url = 'generator-api/project/openFile';
            nqcxPost(url, {
                basedir: basedir,
                path: pathValue,
                name: nameValue
            }, function (result) {
                let relativePathPath = '/';
                let relativePathName = '';
                let cgFileListValue = [];
                if (result.success) {
                    if (result.object) {
                        relativePathPath = result.object.path;
                        relativePathName = result.object.name;
                    }
                    if (result.object.cgFileList)
                        cgFileListValue = result.object.cgFileList;
                }
                path.setRelativePath(relativePathPath + relativePathName);
                path.loadCgFile(relativePathPath, cgFileListValue);
            });
        },
        loadCgFile: function (pathValue, cgFileList) {
            let cgFileHtml = '';
            if (pathValue)
                cgFileHtml += '<li><a href="javascript:void(0);" onclick="path.openFile(\'' + pathValue + '\',\'\');">..</a></li>';
            for (let idx in cgFileList) {
                if (cgFileList.hasOwnProperty(idx)) {
                    if (cgFileList[idx].file)
                        cgFileHtml += '<li>' + cgFileList[idx].name + '</li>';
                    else
                        cgFileHtml += '<li><a href="javascript:void(0);" onclick="path.openFile(\'' + cgFileList[idx].path + '\',\'' + cgFileList[idx].name + '\');">' + cgFileList[idx].name + '</a></li>';
                }
            }
            this.fileShow().html(cgFileHtml);
        }
    }; // end of path

    path.relativePath().keydown(function (e) {
        path.enterKeyDown(e);
    });
</script>
<script type="text/javascript">
    let tableInfo = {
        projectDiv: function () {
            return $('#config_pojo_div');
        },
        info: function () {
            return $('tbody#tableInfo');
        },
        addInfo: function (columns) {
            if (!columns && columns.length === 0)
                return;
            this.info().html('');

            for (let idx in columns) {
                let colstr = '<tr>';
                if (columns.hasOwnProperty(idx)) {
                    colstr += '<td>' + columns[idx].field + '</td>';
                    colstr += '<td>' + columns[idx].type + '</td>';
                    colstr += '<td>' + columns[idx].collation + '</td>';
                    colstr += '<td>' + columns[idx].isNull + '</td>';
                    colstr += '<td>' + columns[idx].key + '</td>';
                    colstr += '<td>' + columns[idx].defaultValue + '</td>';
                    colstr += '<td>' + columns[idx].extra + '</td>';
                    colstr += '<td>' + columns[idx].privileges + '</td>';
                    colstr += '<td>' + columns[idx].comment + '</td>';
                }
                colstr += '</tr>';

                this.info().append(colstr);
            }
        },
        _init: function () {
            this.loadTable()
        },
        loadTable: function () {
            let tableName = table.tableName().val();
            if (!tableName) {
                this.resetTable();
                this.resetConfig()
                return;
            }

            let columns = [];
            nqcxGet("generator-api/table/get/" + tableName, {}, function (result) {
                if (result.object && result.object.columns) {
                    columns = result.object.columns;
                }
                tableInfo.addInfo(columns);
                tableInfo.config(columns);
            });
        },
        resetTable: function () {
            this.info().html('');
        },
        config: function (columns) {
            let tableName = table.tableName().val();
            if (!tableName)
                return;

            let tableHtml = '<hr />';
            tableHtml += '<table border="0" cellpadding="0" cellspacing="0">';
            for (let idx in columns) {
                if (columns.hasOwnProperty(idx)) {
                    tableHtml += '<tr>' + this.row1(columns[idx]) + '</tr>';
                }
            }
            tableHtml += '</table>';
            this.projectDiv().html(tableHtml);
        },
        resetConfig: function () {
            this.projectDiv().html('');
        },
        row1: function (column) {
            let rowHtml = '';
            let field = column.field;
            let type = column.type;
            let field_ = this.toField(field);
            let type_ = this.toType(type);
            let show = 'private ' + type_ + ' ' + field_ + ";";

            rowHtml += '<td><input id="pojoColumn_' + field + '" type="text" name="pojoColumn" class="big_200" value="' + field + '" readonly="true" /></td>';
            rowHtml += '<td>' + type + '</td>';
            rowHtml += '<td><input id="pojoField_' + field + '" type="text" name="pojoField" class="big_200" value="' + field_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><input id="pojoType_' + field + '" type="text" name="pojoType" class="big" value="' + type_ + '" onkeyup="tableInfo.show1(\'' + field + '\')" onafterpaste="tableInfo.show1(\'' + field + '\')" onblur="tableInfo.show1(\'' + field + '\')" /></td>';
            rowHtml += '<td><span id="jojoText_' + field + '">' + show + '</span></td>';

            return rowHtml;
        },
        show1: function (suffix) {
            let field_ = document.getElementById('pojoField_' + suffix).value;
            let type_ = document.getElementById('pojoType_' + suffix).value;
            let show1 = 'private ' + type_ + ' ' + field_ + ";";
            $('#jojoText_' + suffix).html(show1);
        },
        toField: function (input) {
            let prefix = table.colPrefix().val();
            let ps = prefix.split(',');
            if (ps != null && ps.length > 0) {
                for (let idx in ps) {
                    if (ps.hasOwnProperty(idx)) {
                        if (!ps[idx])
                            continue;
                        input = input.replace(new RegExp('^' + ps[idx], 'g'), '');
                    }
                 }
            }
            return input.replaceFirstUP().replaceFirstLow();
        },
        toType: function (input) {
            if (input.startWith('bigint'))
                return "Long";
            else if (input.startWith('int'))
                return "Integer";
            else if (input.startWith('tinyint'))
                return "Integer";
            else if (input.startWith('smallint'))
                return "Integer";
            else if (input.startWith('float'))
                return "Float";
            else if (input.startWith('decimal'))
                return "BigDecimal";
            else if (input.startWith('varchar') || input.startWith('text') || input.startWith('longtext'))
                return "String";
            else if (input.startWith('datetime') || input.startWith('date') || input.startWith('timestamp'))
                return "Date";
            else if (input.startWith('blob'))
                return "byte[]";
            else if (input.startWith('binary'))
                return "String";
            else
                return input;
        }
    };

    // 注册事件
    table.tableNameWatchers.push(() => tableInfo._init());
    table.colPrefixWatchers.push(() => tableInfo.loadTable());
</script>
<script type="text/javascript">
    let api = {
        _: function () {
            return $('input[name="api_"]');
        },
        apiDTO_: function () {
            return $('input[name="apiDTO_"]');
        },
        apiDTOOverwrite_: function () {
            return $('input[name="apiDTOOverwrite_"]');
        },
        apiDTOPackage: function () {
            return $('input[name="apiDTOPackage"]');
        },
        apiDTO: function () {
            return $('input[name="apiDTO"]');
        },
        apiApi_: function () {
            return $('input[name="apiApi_"]');
        },
        apiApiOverwrite_: function () {
            return $('input[name="apiApiOverwrite_"]');
        },
        apiApiPackage: function () {
            return $('input[name="apiApiPackage"]');
        },
        apiApi: function () {
            return $('input[name="apiApi"]');
        },
        _init: function () {
            this._().prop("checked", false);

            this.apiDTO_().prop("checked", true);
            this.apiDTOOverwrite_().prop("checked", false);
            this.apiDTOPackage().val('');
            this.apiDTO().val('');

            this.apiApi_().prop("checked", false);
            this.apiApiOverwrite_().prop("checked", false);
            this.apiApiPackage().val('');
            this.apiApi().val('');
        },
        _reset: function () {
            this._init();
        },
        loadPackage: function () {
            // project package value
            let pValue = project.pPackage().val() || '';

            let tablePack = table.tablePack().val();

            let tableName = table.tableName().val();
            if (!tableName) {
                this._reset();
                return;
            }

            let apiName = tableName.replaceFirstUP();
            let apiDTO = apiName;
            let apiApi = 'I' + apiName + 'Api';

            let poValue = pValue + '.domain.dto' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            let ppValue = pValue + '.api' + (tablePack ? "." + tablePack : "");
            if (ppValue.indexOf(".") === 0 && ppValue.length > 1)
                ppValue = ppValue.substring(1);

            // set value
            this.apiDTOPackage().val(poValue);
            this.apiDTO().val(apiDTO);

            this.apiApiPackage().val(ppValue);
            this.apiApi().val(apiApi);
        }
    };

    table.tableNameWatchers.push(() => api.loadPackage());
    project.module.changeWatchars.push(() => api.loadPackage());
</script>
<script type="text/javascript">
    let dao = {
        _: function () {
            return $('input[name="dao_"]');
        },
        daoPO_: function () {
            return $('input[name="daoPO_"]');
        },
        daoPOOverwrite_: function () {
            return $('input[name="daoPOOverwrite_"]');
        },
        poPackage: function () {
            return $('input[name="daoPOPackage"]');
        },
        po: function () {
            return $('input[name="daoPO"]');
        },
        daoMapper_: function () {
            return $('input[name="daoMapper_"]');
        },
        daoMapperOverwrite_: function () {
            return $('input[name="daoMapperOverwrite_"]');
        },
        mapperPackage: function () {
            return $('input[name="daoMapperPackage"]');
        },
        mapper: function () {
            return $('input[name="daoMapper"]');
        },
        daoMapperXml_: function () {
            return $('input[name="daoMapperXml_"]');
        },
        daoMapperXmlOverwrite_: function () {
            return $('input[name="daoMapperXmlOverwrite_"]');
        },
        mapperXmlPackage: function () {
            return $('input[name="daoMapperXmlPackage"]');
        },
        mapperXml: function () {
            return $('input[name="daoMapperXml"]');
        },
        daoJpa_: function () {
            return $('input[name="daoJpa_"]');
        },
        daoJpaOverwrite_: function () {
            return $('input[name="daoJpaOverwrite_"]');
        },
        jpaPackage: function () {
            return $('input[name="daoJpaPackage"]');
        },
        jpa: function () {
            return $('input[name="daoJpa"]');
        },
        daoCacheSupport_: function () {
            return $('input[name="daoCacheSupport_"]');
        },
        daoCacheSupportOverwrite_: function () {
            return $('input[name="daoCacheSupportOverwrite_"]');
        },
        daoCacheSupportPackage: function () {
            return $('input[name="daoCacheSupportPackage"]');
        },
        daoCacheSupport: function () {
            return $('input[name="daoCacheSupport"]');
        },
        daoDAO_: function () {
            return $('input[name="daoDAO_"]');
        },
        daoDAOOverwrite_: function () {
            return $('input[name="daoDAOOverwrite_"]');
        },
        daoPackage: function () {
            return $('input[name="daoDAOPackage"]');
        },
        dao: function () {
            return $('input[name="daoDAO"]');
        },
        daoDAOImpl_: function () {
            return $('input[name="daoDAOImpl_"]');
        },
        daoDAOImplOverwrite_: function () {
            return $('input[name="daoDAOImplOverwrite_"]');
        },
        daoImplPackage: function () {
            return $('input[name="daoDAOImplPackage"]');
        },
        daoImpl: function () {
            return $('input[name="daoDAOImpl"]');
        },
        daoDAOTest_: function () {
            return $('input[name="daoDAOTest_"]');
        },
        daoDAOTestOverwrite_: function () {
            return $('input[name="daoDAOTestOverwrite_"]');
        },
        testPackage: function () {
            return $('input[name="daoDAOTestPackage"]');
        },
        test: function () {
            return $('input[name="daoDAOTest"]');
        },
        _init: function () {
            this._().prop("checked", false);

            this.daoPO_().prop("checked", true);
            this.daoPOOverwrite_().prop("checked", false);
            this.poPackage().val('');
            this.po().val('');
            this.daoMapper_().prop("checked", true);
            this.daoMapperOverwrite_().prop("checked", false);
            this.mapperPackage().val('');
            this.mapper().val('');
            this.daoMapperXml_().prop("checked", true);
            this.daoMapperXmlOverwrite_().prop("checked", false);
            this.mapperXmlPackage().val('');
            this.mapperXml().val('');
            this.daoJpa_().prop("checked", false);
            this.daoJpaOverwrite_().prop("checked", false);
            this.jpaPackage().val('');
            this.jpa().val('');
            this.daoCacheSupport_().prop("checked", false);
            this.daoCacheSupportOverwrite_().prop("checked", false);
            this.daoCacheSupportPackage().val('');
            this.daoCacheSupport().val('');
            this.daoDAO_().prop("checked", true);
            this.daoDAOOverwrite_().prop("checked", false);
            this.daoPackage().val('');
            this.dao().val('');
            this.daoDAOImpl_().prop("checked", true);
            this.daoDAOImplOverwrite_().prop("checked", false);
            this.daoImplPackage().val('');
            this.daoImpl().val('');
            this.daoDAOTest_().prop("checked", true);
            this.daoDAOTestOverwrite_().prop("checked", false);
            this.testPackage().val('');
            this.test().val('');
        },
        _reset() {
            this._init();
        },
        loadPackage: function () {
            // project pakcage value
            let pValue = project.pPackage().val() || '';

            let tablePack = table.tablePack().val();

            let tableName = table.tableName().val();
            if (!tableName) {
                this._reset();
                return;
            }

            let daoName = tableName.replaceFirstUP();
            let daoPO = daoName + "PO";
            let daoMapper = 'I' + daoName + 'Mapper';
            let daoMapperXml = daoMapper;
            let daoJpa = 'I' + daoName + 'Jpa';
            let daoCacheSupport = 'CacheSupport';
            let daoDao = 'I' + daoName + 'DAO';
            let daoDaoImpl = daoName + 'DAO';
            let daoTest = daoDaoImpl + 'Test';

            let poValue = pValue + '.domain.po' + (tablePack ? "." + tablePack : "");
            if (poValue.indexOf(".") === 0 && poValue.length > 1)
                poValue = poValue.substring(1);

            let mapperValue = pValue + '.data.mapper' + (tablePack ? "." + tablePack : "");
            if (mapperValue.indexOf(".") === 0 && mapperValue.length > 1)
                mapperValue = mapperValue.substring(1);

            let mapperXmlValue = mapperValue;

            let jpaValue = pValue + '.data.jpa' + (tablePack ? "." + tablePack : "");
            if (jpaValue.indexOf(".") === 0 && jpaValue.length > 1)
                jpaValue = jpaValue.substring(1);

            let cacheValue = pValue + '.data.cache';
            if (cacheValue.indexOf(".") === 0 && cacheValue.length > 1)
                cacheValue = cacheValue.substring(1);

            let daoValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (daoValue.indexOf(".") === 0 && daoValue.length > 1)
                daoValue = daoValue.substring(1);

            let daoImplValue = daoValue + '.impl';
            if (daoImplValue.indexOf(".") === 0 && daoImplValue.length > 1)
                daoImplValue = daoImplValue.substring(1);

            let testValue = pValue + '.dao' + (tablePack ? "." + tablePack : "");
            if (testValue.indexOf(".") === 0 && testValue.length > 1)
                testValue = testValue.substring(1);

            // set value
            this.poPackage().val(poValue);
            this.po().val(daoPO);
            this.mapperPackage().val(mapperValue);
            this.mapper().val(daoMapper);
            this.mapperXmlPackage().val(mapperXmlValue);
            this.mapperXml().val(daoMapperXml);
            this.jpaPackage().val(jpaValue);
            this.jpa().val(daoJpa);
            this.daoCacheSupportPackage().val(cacheValue);
            this.daoCacheSupport().val(daoCacheSupport);
            this.daoPackage().val(daoValue);
            this.dao().val(daoDao);
            this.daoImplPackage().val(daoImplValue);
            this.daoImpl().val(daoDaoImpl);
            this.testPackage().val(testValue);
            this.test().val(daoTest);
        }
    };

    table.tableNameWatchers.push(() => dao.loadPackage());
    project.module.changeWatchars.push(() => dao.loadPackage());
</script>
<script type="text/javascript">
    let service = {
        _: function () {
            return $('input[name="service_"]');
        },
        serviceVO_: function () {
            return $('input[name="serviceVO_"]');
        },
        serviceVOOverwrite_: function () {
            return $('input[name="serviceVOOverwrite_"]');
        },
        serviceVOPackage: function () {
            return $('input[name="serviceVOPackage"]');
        },
        serviceVO: function () {
            return $('input[name="serviceVO"]');
        },
        serviceService_: function () {
            return $('input[name="serviceService_"]');
        },
        serviceServiceOverwrite_: function () {
            return $('input[name="serviceServiceOverwrite_"]');
        },
        serviceServicePackage: function () {
            return $('input[name="serviceServicePackage"]');
        },
        serviceService: function () {
            return $('input[name="serviceService"]');
        },
        serviceServiceImpl_: function () {
            return $('input[name="serviceServiceImpl_"]');
        },
        serviceServiceImplOverwrite_: function () {
            return $('input[name="serviceServiceImplOverwrite_"]');
        },
        serviceServiceImplPackage: function () {
            return $('input[name="serviceServiceImplPackage"]');
        },
        serviceServiceImpl: function () {
            return $('input[name="serviceServiceImpl"]');
        },
        serviceServiceTest_: function () {
            return $('input[name="serviceServiceTest_"]');
        },
        serviceServiceTestOverwrite_: function () {
            return $('input[name="serviceServiceTestOverwrite_"]');
        },
        serviceTestPackage: function () {
            return $('input[name="serviceServiceTestPackage"]');
        },
        serviceTest: function () {
            return $('input[name="serviceServiceTest"]');
        },
        _init: function () {
            this._().prop("checked", false);

            this.serviceVO_().prop("checked", true);
            this.serviceVOOverwrite_().prop("checked", false);
            this.serviceVOPackage().val('');
            this.serviceVO().val('');
            this.serviceService_().prop("checked", true);
            this.serviceServiceOverwrite_().prop("checked", false);
            this.serviceServicePackage().val('');
            this.serviceService().val('');
            this.serviceServiceImpl_().prop("checked", true);
            this.serviceServiceImplOverwrite_().prop("checked", false);
            this.serviceServiceImplPackage().val('');
            this.serviceServiceImpl().val('');
            this.serviceServiceTest_().prop("checked", true);
            this.serviceServiceTestOverwrite_().prop("checked", false);
            this.serviceTestPackage().val('');
            this.serviceTest().val('');
        },
        _reset: function () {
            this._init();
        },
        loadPackage: function () {
            // project pakcage value
            let pValue = project.pPackage().val() || '';

            let tablePack = table.tablePack().val();

            let tableName = table.tableName().val();
            if (!tableName) {
                this._reset();
                return;
            }

            let serviceName = tableName.replaceFirstUP();
            let serviceVO = serviceName + "VO";
            let serviceService = 'I' + serviceName + "Service";
            let serviceServiceImpl = serviceName + "Service";
            let serviceServiceTest = serviceServiceImpl + "Test";

            let svValue = pValue + '.domain.vo' + (tablePack ? "." + tablePack : "");
            if (svValue.indexOf(".") === 0 && svValue.length > 1)
                svValue = svValue.substring(1);

            let ssValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (ssValue.indexOf(".") === 0 && ssValue.length > 1)
                ssValue = ssValue.substring(1);

            let ssiValue = ssValue + '.impl';
            if (ssiValue.indexOf(".") === 0 && ssiValue.length > 1)
                ssiValue = ssiValue.substring(1);

            let sstValue = pValue + '.service' + (tablePack ? "." + tablePack : "");
            if (sstValue.indexOf(".") === 0 && sstValue.length > 1)
                sstValue = sstValue.substring(1);

            // set value
            this.serviceVOPackage().val(svValue);
            this.serviceVO().val(serviceVO);
            this.serviceServicePackage().val(ssValue);
            this.serviceService().val(serviceService);
            this.serviceServiceImplPackage().val(ssiValue);
            this.serviceServiceImpl().val(serviceServiceImpl);
            this.serviceTestPackage().val(sstValue);
            this.serviceTest().val(serviceServiceTest);
        }
    };

    table.tableNameWatchers.push(() => service.loadPackage());
    project.module.changeWatchars.push(() => service.loadPackage());
</script>
<script type="text/javascript">
    let web = {
        _: function () {
            return $('input[name="web_"]');
        },
        webApiController_: function () {
            return $('input[name="webApiController_"]');
        },
        webApiControllerOverwrite_: function () {
            return $('input[name="webApiControllerOverwrite_"]');
        },
        webApiControllerPackage: function () {
            return $('input[name="webApiControllerPackage"]');
        },
        webApiController: function () {
            return $('input[name="webApiController"]');
        },
        webCloudapi_: function () {
            return $('input[name="webCloudapi_"]');
        },
        webCloudapiOverwrite_: function () {
            return $('input[name="webCloudapiOverwrite_"]');
        },
        webCloudapiPackage: function () {
            return $('input[name="webCloudapiPackage"]');
        },
        webCloudapi: function () {
            return $('input[name="webCloudapi"]');
        },
        webOpenapi_: function () {
            return $('input[name="webOpenapi_"]');
        },
        webOpenapiOverwrite_: function () {
            return $('input[name="webOpenapiOverwrite_"]');
        },
        webOpenapiPackage: function () {
            return $('input[name="webOpenapiPackage"]');
        },
        webOpenapi: function () {
            return $('input[name="webOpenapi"]');
        },
        _init: function () {
            this._().prop("checked", false);

            this.webApiController_().prop("checked", true);
            this.webApiControllerOverwrite_().prop("checked", false);
            this.webApiControllerPackage().val('');
            this.webApiController().val('');

            this.webCloudapi_().prop("checked", true);
            this.webCloudapiOverwrite_().prop("checked", false);
            this.webCloudapiPackage().val('');
            this.webCloudapi().val('');

            this.webOpenapi_().prop("checked", true);
            this.webOpenapiOverwrite_().prop("checked", false);
            this.webOpenapiPackage().val('');
            this.webOpenapi().val('');
        },
        _reset: function () {
            this._init();
        },
        loadPackage: function () {
            // project pakcage value
            let pValue = project.pPackage().val() || '';

            let tablePack = table.tablePack().val();

            let tableName = table.tableName().val();
            if (!tableName) {
                this._reset();
                return;
            }

            let webName = tableName.replaceFirstUP();

            let webApiController = webName + "Controller";
            let wacValue = pValue + '.web.api.controller' + (tablePack ? "." + tablePack : "");
            if (wacValue.indexOf(".") === 0 && wacValue.length > 1)
                wacValue = wacValue.substring(1);

            this.webApiControllerPackage().val(wacValue);
            this.webApiController().val(webApiController);

            let webCloudapi = webName + 'Cloudapi';
            let wccValue = pValue + '.web.cloud.controller' + (tablePack ? "." + tablePack : "");
            if (wccValue.indexOf(".") === 0 && wccValue.length > 1)
                wccValue = wccValue.substring(1);

            this.webCloudapiPackage().val(wccValue);
            this.webCloudapi().val(webCloudapi);

            let webOpenapi = webName + 'Openapi';
            let wocValue = pValue + '.web.open.controller' + (tablePack ? "." + tablePack : "");
            if (wocValue.indexOf(".") === 0 && wocValue.length > 1)
                wocValue = wocValue.substring(1);

            this.webOpenapiPackage().val(wocValue);
            this.webOpenapi().val(webOpenapi);
        }
    };

    table.tableNameWatchers.push(() => web.loadPackage());
    project.module.changeWatchars.push(() => web.loadPackage());
</script>
<script type="text/javascript">
    let ui = {
        _: function () {
            return $('input[name="ui_"]');
        },
        uiApi_: function () {
            return $('input[name="uiApi_"]');
        },
        uiApiOverwrite_: function () {
            return $('input[name="uiApiOverwrite_"]');
        },
        uiApiPackage: function () {
            return $('input[name="uiApiPackage"]');
        },
        uiApi: function () {
            return $('input[name="uiApi"]');
        },
        uiView_: function () {
            return $('input[name="uiView_"]');
        },
        uiViewOverwrite_: function () {
            return $('input[name="uiViewOverwrite_"]');
        },
        uiViewPackage: function () {
            return $('input[name="uiViewPackage"]');
        },
        uiView: function () {
            return $('input[name="uiView"]');
        },
        _init: function () {
            this._().prop("checked", false);

            this.uiApi_().prop("checked", false);
            this.uiApiOverwrite_().prop("checked", false);
            this.uiApiPackage().val('');
            this.uiApi().val('');

            this.uiView_().prop("checked", false);
            this.uiViewOverwrite_().prop("checked", false);
            this.uiViewPackage().val('');
            this.uiView().val('');
        },
        _reset: function () {
            this._init();
        },
        loadPackage: function () {
            let tablePack = table.tablePack().val();

            let tableName = table.tableName().val();
            if (!tableName) {
                this._reset();
                return;
            }

            let uiName = tableName;
            let uiApi = uiName;
            let uiView = uiName;

            // set value
            let uaValue = tablePack || '';
            this.uiApiPackage().val(uaValue);
            this.uiApi().val(uiApi);

            let uvValue = tablePack || '';
            this.uiViewPackage().val(uvValue);
            this.uiView().val(uiView);
        }
    };

    table.tableNameWatchers.push(() => ui.loadPackage());
    project.module.changeWatchars.push(() => ui.loadPackage());
</script>
<script type="text/javascript">
    let checkForm = function () {
        if (!project._loaded || !project.basedirElement().val()) {
            $.messager.show({
                title: 'Error',
                msg: 'Basedir not exists.'
            });
            return false;
        } else if (!project.authorElement().val()) {
            $.messager.show({
                title: 'Error',
                msg: 'Please input author.'
            });
            return false;
        } else if (!project.pName().val()) {
            $.messager.show({
                title: 'Error',
                msg: 'Please select project.'
            });
            return false;
        } else if (!api._().is(":checked")
            && !dao._().is(":checked")
            && !service._().is(":checked")
            && !web._().is(":checked")
            && !ui._().is(":checked")) {
            $.messager.show({
                title: 'Error',
                msg: 'Please select modules.'
            });
            return false;
        }
        return true;
    };

    let generate = function () {
        $('#generate_form').form('nqcxSubmit', {
            url: "generator-api/generate/doit",
            onSubmit: function () {
                if (checkForm())
                    return $(this).form('validate');
                return false;
            },
            addDatas: {
                tableName: table.tableName().val(),
                tablePack: table.tablePack().val(),
                author: project.authorElement().val(),
                basedir: project.basedirElement().val(),
                pName: project.pName().val(),
                pPath: project.pPath().val(),
                pPackage: project.pPackage().val(),
                pType: project.pType().val(),
                apiModule: project.module.api().val(),
                daoModule: project.module.dao().val(),
                serviceModule: project.module.service().val(),
                webModule: project.module.web().val(),
                uiModule: project.module.ui().val()
            },
            success: function (result) {
                if (result.success) {
                    $.messager.show({
                        title: 'Success',
                        msg: '保存成功'
                    });
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.errorText
                    });
                }
            }
        });
    };

    $('#generate_btn').click(function () {
        generate();
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        // 初始化 db 相关值
        db._init();
        // 初始化 table 相关
        table._init();
        // 初始化 project 相关
        project._init();
    });
</script>
</body>
</html>
